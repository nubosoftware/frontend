var l=function(e){return e.toLocaleString()};String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(f,k){return"undefined"!=typeof e[k]?e[k]:f})});String.prototype.startsWith||(String.prototype.startsWith=function(e,f){return this.substr(f||0,e.length)===e});function AppController(){this.currentView=null;this.showView=function(e){null!=this.currentView&&this.currentView.undelegateEvents();this.currentView=e;this.currentView.render()}}
$.fn.localize=function(e){$(this).each(function(f){e?(console.log(f+": "+$(this).attr("watermark")),$(this).Watermark(l($(this).attr("watermark")).trim())):(console.log(f+": "+$(this).attr("localize-text")),$(this).text(l($(this).attr("localize-text"))))})};
function track(){var e={};e.u=document.location.href;e.ww=window.innerWidth;e.wh=window.innerHeight;document.referrer&&""!=document.referrer&&(e.r=document.referrer);window.userEmail&&(e.userEmail=window.userEmail);e.ua=navigator.userAgent;e.x=Math.floor(1E13*Math.random());var f=[],k;for(k in e)e.hasOwnProperty(k)&&f.push(encodeURIComponent(k)+"="+encodeURIComponent(e[k]));e=new Image;f="https://nubosoftware.com/tp.gif?"+f.join("&");e.src=f}
var WallpaperColorList=[{id:"0",color:"#74B52A"},{id:"1",color:"#58AE61"},{id:"2",color:"#C5C52E"},{id:"3",color:"#6D40AF"},{id:"4",color:"#9627A8"},{id:"5",color:"#C92A95"},{id:"6",color:"#E23A44"},{id:"7",color:"#DB932A"},{id:"8",color:"#4B47B1"},{id:"9",color:"#1D64BD"},{id:"10",color:"#35A7D8"},{id:"11",color:"#4FAEAA"},{id:"12",color:"#5ECAA6"}],WallpaperImageList=[{id:"0",image:"#58585A"},{id:"1",image:"images/candy.jpg"},{id:"2",image:"images/pacman.jpg"},{id:"3",image:"images/cars.jpg"},{id:"4",
image:"images/under.jpg"},{id:"5",image:"images/delicate.jpg"},{id:"6",image:"images/spray.jpg"},{id:"7",image:"images/picasso.jpg"},{id:"8",image:"images/jeans.jpg"},{id:"9",image:"images/flowers.jpg"},{id:"10",image:"images/motor.jpg"},{id:"11",image:"images/barcode.jpg"},{id:"12",image:"images/ILove.jpg"}],mgmtURL,clickbgColor="#828282",bgColor="#5B5B5B",changedNode=null,loginToken=null,loggedIn=!1,authenticationRequired=!1,passcodeActivationRequired=!1,orgName="",authType=0,clientProperties=[],
uploadExternalWallpaper=!0,pendingValidation=!1,getJSON,jsonError,playerVersion="1.2",wallpaperColor="#58585A",wallpaperImage="",browserType="",enterPasscode="",demoActivation=!1,playbackWidth,playbackHeight,playbackScale,playbackFile,playbackStartTime,passcodeExpired=!1;console.log("Starting login.js");$(function(){document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1)});
function getSessionId(){browserType=0<=navigator.userAgent.indexOf(" OPR/")?"opera":0<=navigator.userAgent.indexOf("Chrome/")?"chrome":0<=navigator.userAgent.indexOf("Firefox/")?"firefox":0<=navigator.userAgent.indexOf("Safari/")?"safari":"ie"}
function get_browser_version(){var e=navigator.userAgent,f,k=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(k[1]))return f=/\brv[ :]+(\d+)/g.exec(e)||[],f[1]||"";if("Chrome"===k[1]&&(f=e.match(/\bOPR\/(\d+)/),null!=f))return+f[1];k=k[2]?[k[1],k[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(f=e.match(/version\/(\d+)/i))&&k.splice(1,1,f[1]);return k[1]}
function formatPage(){var e=l("alignText");console.log("alignText="+e);null!=e&&""!=e?$(".alignText").css("text-align",e):$(".alignText").css("text-align","left");$("[localize-text]").localize(!1);$("[watermark]").localize(!0);$("span.appbutton").mousedown(function(f){$(this).css("background-color",clickbgColor);changedNode=$(this)});$("span.appbutton").mouseup(function(f){null!=changedNode&&(changedNode.css("background-color",bgColor),changedNode=null)});$("span.appbutton").mouseout(function(f){null!=
changedNode&&(changedNode.css("background-color",bgColor),changedNode=null)});console.log("formatPage. wallpaperColor: "+wallpaperColor+", wallpaperImage: "+wallpaperImage);$("#toolbardiv").css("background-color","#58585A");$("#maindiv").css("background-color",wallpaperColor);$("#maindiv").css("background-image","url("+wallpaperImage+")");$("#datadiv").css("background-color",wallpaperColor);$("#datadiv").css("background-image","url("+wallpaperImage+")")}
var mobilecheck=function(){var e=!1,f=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(f)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(f.substr(0,
4)))e=!0;return e};
$(function(){function e(){null!=b&&(0!=b.timeoutId&&(clearTimeout(b.timeoutId),b.timeoutId=0),b=null);null!=E&&(0!=E.timeoutId&&(clearTimeout(E.timeoutId),E.timeoutId=0),E=null);A=null}function f(a){var q=a.getHours();a=a.getMinutes();var b=12<=q?"PM":"AM",q=q%12;return(q?q:12)+":"+(10>a?"0"+a:a)+" "+b}function k(a,q,b,c,d){$("#fromDatepicker").val(a);$("#toDatepicker").val(q);$("#searchNames").val(b);$("#fromSelector").val(c);$("#toSelector").val(d)}mgmtURL=location.protocol+"//"+location.host+"/";
console.log("mgmtURL: "+mgmtURL);var d=new (Backbone.Model.extend({initialize:function(){this.set({id:1,firstName:"",lastName:"",jobTitle:"",workEmail:"",deviceID:""});this.fetch();getSessionId();this.get("workEmail");wallpaperColor=this.get("wallpaperColor");if(null==wallpaperColor||""==wallpaperColor)wallpaperColor="#58585A",this.set({wallpaperColor:wallpaperColor}),this.save();wallpaperImage=this.get("wallpaperImage")},sync:function(a,q){console.log("model.sync. "+a+": "+JSON.stringify(q));try{if("read"==
a){if(null!=localStorage.loginSettings){var b=obj=JSON.parse(localStorage.loginSettings);this.set(b);console.log("localStorage.loginSettings:"+JSON.stringify(b))}}else"update"==a&&(localStorage.loginSettings=JSON.stringify(this.attributes))}catch(c){console.log("Error in sync: "+c.message)}}})),m={Android:function(){return navigator.userAgent.match(/Android/i)?!0:!1},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)?!0:!1},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)?
!0:!1},Windows:function(){return navigator.userAgent.match(/IEMobile/i)?!0:!1},any:function(){return m.Android()||m.BlackBerry()||m.iOS()||m.Windows()}},n=function(){var a=mgmtURL+"validate?deviceid="+encodeURIComponent(d.get("deviceID"))+"&activationKey="+encodeURIComponent(d.get("activationKey"))+"&playerVersion="+playerVersion;console.log("newLoginToken. url: "+a);getJSON(a,function(a){console.log("newLoginToken. data: "+JSON.stringify(a,null,4));1==a.status?(loginToken=a.loginToken,null!=O&&O.checkPasscode()):
window.location.hash="validation"})},u=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},render:function(){var a=_.template($("#download_template").html(),{});this.$el.html(a);formatPage();m.iOS()?this.domain&&"sysaid.com"==this.domain?($("#downloadLink").css("visibility","hidden"),$("#iosMessage").css("visibility","hidden"),$("#downloadTwoSteps").css("visibility","visible"),$("#downloadStep1").css("visibility","visible"),$("#downloadStep2").css("visibility","visible"),$("#welcome").css("visibility",
"visible")):($("#welcome").css("visibility","hidden"),$("#downloadLink").css("visibility","hidden"),$("#downloadTwoSteps").css("visibility","hidden"),$("#downloadStep1").css("visibility","hidden"),$("#downloadStep2").css("visibility","hidden"),$("#iosMessage").css("visibility","visible")):($("#iosMessage").css("visibility","hidden"),$("#downloadLink").css("visibility","visible"),$("#downloadTwoSteps").css("visibility","hidden"),$("#downloadStep1").css("visibility","hidden"),$("#downloadStep2").css("visibility",
"hidden"),$("#welcome").css("visibility","visible"))},events:{"click #downloadLink":"downloadAndorid","click #downloadStep1":"downloadIOS1","click #downloadStep2":"downloadIOS2"},downloadAndorid:function(a){window.location.href="/download?dtype=APK"},downloadIOS1:function(a){window.location.href="/download?dtype=IOS1"},downloadIOS2:function(a){window.location.href="/download?dtype=IOS2"}}),y=Backbone.View.extend({el:$("#maindiv"),initialize:function(){demoActivation=!1},render:function(){var a=_.template($("#greeting_template").html(),
{});this.$el.html(a);formatPage()},events:{"click #create":"clickCreate","click #signin":"clickAlready","click #demo":"clickDemo"},clickCreate:function(a){window.location.hash="createPlayer"},clickAlready:function(a){window.location.hash="already"},clickDemo:function(a){a=Math.floor(1E6*Math.random()+1);a=mgmtURL+"validate?username="+encodeURIComponent(d.get("workEmail"))+"&deviceid="+a+"&activationKey=5488884a97a98c0db8f863c074eff683ae3c5819a594e89fc6283772f9a2b26d64e7bb6fad21fc74d729c301d460000f";
console.log("DEMO. url: "+a);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));1==a.status?(loginToken=a.loginToken,d.set({activationKey:"5488884a97a98c0db8f863c074eff683ae3c5819a594e89fc6283772f9a2b26d64e7bb6fad21fc74d729c301d460000f"}),console.log("DEMO. loginToken: "+loginToken),loggedIn=demoActivation=!0,window.location.hash="player"):window.location.hash="error"})}}),b=null,c=Backbone.View.extend({el:$("#maindiv"),initialize:function(){b=this},timeoutId:0,render:function(){var a;pendingValidation?
a=_.template($("#validation_template").html(),{activationEmail:d.get("workEmail")}):(a=d.attributes,a=_.template($("#splash_template").html(),a));this.$el.html(a);formatPage();this.timeoutId=setTimeout(this.checkValidation,2E3)},events:{"click #changeBtn":"clickChange"},clickChange:function(a){d.set({workEmail:"",activationKey:""});d.save();window.location.hash="createPlayer"},checkValidation:function(){var a=mgmtURL+"validate?username="+encodeURIComponent(d.get("workEmail"))+"&deviceid="+encodeURIComponent(d.get("deviceID"))+
"&activationKey="+encodeURIComponent(d.get("activationKey"))+"&playerVersion="+playerVersion;getJSON(a,function(a){console.log(JSON.stringify(a,null,4));if(1==a.status){this.timeoutId=0;pendingValidation=!1;loginToken=a.loginToken;passcodeActivationRequired=a.passcodeActivationRequired;orgName=a.orgName;authType=a.authType;authenticationRequired=a.authenticationRequired;uploadExternalWallpaper=d.get("uploadExternalWallpaper");if(null==uploadExternalWallpaper||uploadExternalWallpaper){var c=a.clientProperties,
g;for(g in c)if(console.log(g+" : "+c[g]),0==g.localeCompare("wallpaper")){wallpaperColor="";wallpaperImage=mgmtURL+c[g];uploadExternalWallpaper=!1;break}}d.set({firstName:a.firstName,lastName:a.lastName,jobTitle:a.jobTitle,wallpaperImage:wallpaperImage,wallpaperColor:wallpaperColor,uploadExternalWallpaper:uploadExternalWallpaper});d.save();window.location.hash=authenticationRequired?"auth":passcodeActivationRequired?"passcodeActivation":"passcode"}else 0==a.status?(console.log("pending..."),pendingValidation=
!0,null!=b&&(this.timeoutId=setTimeout(b.checkValidation,2E3))):301==a.status?(mgmtURL=a.mgmtURL,"/"!=mgmtURL.substr(mgmtURL.length-1)&&(mgmtURL+="/"),console.log("checkValidation. status=301, mgmtURL: "+mgmtURL),pendingValidation=!0,null!=b&&(this.timeoutId=setTimeout(b.checkValidation,0))):2==a.status?(this.timeoutId=0,pendingValidation=!1,d.set({activationKey:""}),window.location.hash="expired"):3==a.status?(this.timeoutId=0,pendingValidation=!1,d.set({activationKey:""}),window.location.hash="error"):
4==a.status?(this.timeoutId=0,pendingValidation=!1,console.log("passcodelock"),window.location.hash="passcodelock"):5==a.status?(this.timeoutId=0,pendingValidation=!1,console.log("disableUserDevice"),d.set({errorType:a.status,adminName:a.adminName,adminEmail:a.adminEmail}),d.save(),window.location.hash="disableUserDevice"):6==a.status?(this.timeoutId=0,pendingValidation=!1,console.log("disableUserDevice"),d.set({errorType:a.status,adminName:a.adminName,adminEmail:a.adminEmail,orgName:a.orgName}),
d.save(),window.location.hash="disableUserDevice"):(console.log("checkValidation. error status: "+a.status),this.timeoutId=0,pendingValidation=!1,d.set({activationKey:""}),window.location.hash="error")})}}),p=null,x=Backbone.View.extend({el:$("#maindiv"),initialize:function(){p=this},token:null,email:null,cloneActivation:null,timeoutId:0,afterValidation:!1,successActivation:!1,activationDeviceType:"",render:function(){var a;this.afterValidation?this.successActivation?(a=_.template($("#welcome_template").html(),
{activationDeviceType:this.activationDeviceType}),this.$el.html(a),formatPage(),$("#startDeviceText").text(l("startUsingDevice")+" "+this.activationDeviceType)):(a=d.attributes,a=_.template($("#activation_err_template").html(),a),this.$el.html(a),formatPage(),"Web"!=this.activationDeviceType&&$("#activationErrorText").text(l("activationExpired")+" "+l("openApp"))):(this.$el.html(""),this.checkActivationLink());track()},events:{"click #createWebPlayer":"clickCreate"},clickCreate:function(a){window.location.hash=
"createPlayer"},checkActivationLink:function(){var a=mgmtURL+"activationLink?token="+encodeURIComponent(this.token)+"&cloneActivation="+encodeURIComponent(this.cloneActivation);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));p.afterValidation=!0;0==a.status?(p.activationDeviceType=a.deviceType,p.successActivation=!0,window.userEmail=a.email):(p.successActivation=!1,p.activationDeviceType=a.deviceType);p.render()})}}),A=null,N=Backbone.View.extend({el:$("#maindiv"),initialize:function(){A=
this},token:null,email:null,cloneActivation:null,timeoutId:0,afterValidation:!1,successReset:!1,resetDeviceType:"",render:function(){var a;this.afterValidation?this.successReset?(a=_.template($("#resetPasscodeLink_template").html(),{activationDeviceType:this.resetDeviceType}),this.$el.html(a),formatPage()):(a=d.attributes,a=_.template($("#activation_err_template").html(),a),this.$el.html(a),formatPage(),$("#resetPasscodeTxt").text(l("activationExpired")+" "+l("openApp"))):(this.$el.html(""),this.checkResetLink());
track()},checkResetLink:function(){var a=mgmtURL+"activationLink?token="+encodeURIComponent(this.token)+"&cloneActivation="+encodeURIComponent(this.cloneActivation);console.log("checkResetLink. url: "+a);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));A.afterValidation=!0;0==a.status?(A.resetDeviceType=a.deviceType,A.successReset=!0,window.userEmail=a.email):(A.successReset=!1,A.resetDeviceType=a.deviceType);A.render()})}}),I=null,G=Backbone.View.extend({el:$("#maindiv"),initialize:function(){I=
this},token:null,email:null,cloneActivation:null,timeoutId:0,afterValidation:!1,successUnlock:!1,render:function(){var a;this.afterValidation?this.successUnlock?(a=_.template($("#unlockPasscodeLink_template").html(),a),this.$el.html(a),formatPage()):(console.log("UnlockPasscodeLinkView. activation_err"),a=d.attributes,a=_.template($("#activation_err_template").html(),a),this.$el.html(a),formatPage(),$("#unlockPasscodeTxt").text(l("activationExpired")+" "+l("openApp"))):(this.$el.html(""),this.checkUnlockLink());
track()},checkUnlockLink:function(){var a=mgmtURL+"unlockPassword?loginemailtoken="+encodeURIComponent(this.token)+"&email="+encodeURIComponent(this.email);console.log("checkUnlockLink. url: "+a);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));I.afterValidation=!0;1==a.status?(I.successUnlock=!0,window.userEmail=a.email):(console.log("checkUnlockLink. status: "+a.status),I.successUnlock=!1);I.render()})}}),C=null,J=null,K=Backbone.View.extend({el:$("#maindiv"),initialize:function(){J=
this},render:function(){var a=d.attributes,a=_.template($("#create_player_template").html(),a);this.$el.html(a);pendingValidation=!0;formatPage();$("#edFirstName").focus()},events:{"click #create_create":"clickCreate","input #edJobTitle":"jobKey","input input[type=text]":"resetError","blur #edJobTitle":"hideSuggestionList","mousedown .dropCommon":"clickSuggestion","keydown input":"keyDown"},keyDown:function(a){console.log("keyDown "+a.keyCode);if(13==a.keyCode){var b=a.target.id,c=$("#maindiv").find("input,a,select,button,textarea").filter(":visible"),
b=c.eq(c.index($("#"+b))+1);b.length?b.focus():this.clickCreate(a);return!1}},resetError:function(a){var b=a.target.id;console.log("event.target.id="+a.target.id);$("#"+b).removeClass("error");a="#"+b.substring(2)+"Err";$(a).text("")},jobKey:function(a){a=$("#edJobTitle").val();console.log("input. #edJobTitle="+a);this.openSuggestList(a)},hideSuggestionList:function(){for(var a=0;4>a;a++)$("#drop"+(a+1)).css("visibility","hidden")},clickSuggestion:function(a){var b=a.target.id;console.log("event.target.id="+
a.target.id);$("#edJobTitle").val($("#"+b).text())},openSuggestList:function(a){if(null==C){var b=this;getJSON(mgmtURL+"html/player/jobs_list.json",function(c){console.log(JSON.stringify(c,null,4));C=c;b.openSuggestList(a)})}else if(this.hideSuggestionList(),!(2>a.length)){for(var c=[],g=0;g<C.length&&4>c.length;g++)C[g].substr(0,a.length).toLowerCase()==a.toLowerCase()&&c.push(C[g]);console.log("openSuggestList. suggestions.length="+c.length);for(g=0;g<c.length;g++){var d="#drop"+(g+1);$(d).text(c[g]);
g+1==c.length?$(d).addClass("roundDrop"):$(d).removeClass("roundDrop");console.log("spanname="+d);$(d).css("visibility","visible")}}},clickCreate:function(a){$("#FirstNameErr").text("");$("#edFirstName").removeClass("error");$("#LastNameErr").text("");$("#edLastName").removeClass("error");$("#JobTitleErr").text("");$("#edJobTitle").removeClass("error");$("#WorkEmailErr").text("");$("#edWorkEmail").removeClass("error");a=$("#edFirstName").val()==l("firstName").trim()?"":$("#edFirstName").val();a=a.substr(0,
1).toUpperCase()+a.substr(1);var b=$("#edLastName").val()==l("lastName").trim()?"":$("#edLastName").val(),b=b.substr(0,1).toUpperCase()+b.substr(1),c=$("#edJobTitle").val()==l("jobTitle").trim()?"":$("#edJobTitle").val(),c=c.substr(0,1).toUpperCase()+c.substr(1),g=$("#edWorkEmail").val()==l("workEmail").trim()?"":$("#edWorkEmail").val();d.set({firstName:a,lastName:b,jobTitle:c,workEmail:g,deviceID:"web_default_"+browserType+"_"+g});d.save();var f=!1;""==a&&(f=!0,$("#FirstNameErr").text(l("emptyField")),
$("#edFirstName").addClass("error"));""==b&&(f=!0,$("#LastNameErr").text(l("emptyField")),$("#edLastName").addClass("error"));""==c&&(f=!0,$("#JobTitleErr").text(l("emptyField")),$("#edJobTitle").addClass("error"));""==g?(f=!0,$("#WorkEmailErr").text(l("emptyField")),$("#edWorkEmail").addClass("error")):/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(g)||(f=!0,$("#WorkEmailErr").text(l("invalidWorkEmail")),
$("#edWorkEmail").addClass("error"));f||this.activatePlayer()},activatePlayer:function(){var a=d.get("workEmail")+"_"+d.get("deviceID"),a=CryptoJS.HmacSHA1(a,"1981abe0d32d93967648319b013b03f05a119c9f619cc98f");console.log("signature="+a);a=mgmtURL+"activate?deviceid="+encodeURIComponent(d.get("deviceID"))+"&email="+encodeURIComponent(d.get("workEmail"))+"&first="+encodeURIComponent(d.get("firstName"))+"&last="+encodeURIComponent(d.get("lastName"))+"&title="+encodeURIComponent(d.get("jobTitle"))+"&signature="+
encodeURIComponent(a)+"&regid=none&deviceType=Web&deviceName=Web";getJSON(a,function(a){console.log(JSON.stringify(a,null,4));0==a.status?(d.set({activationKey:a.activationKey}),d.save(),window.location.hash="validation"):2==a.status?($("#workEmailSendErr").text(l("emailNotExist")),$("#workEmailSend").addClass("error"),$("#sendMeActivationCreateBtn").css("visibility","visible")):3==a.status?(d.set({activationKey:""}),d.save(),window.location.hash="createPlayer"):301==a.status&&(mgmtURL=a.mgmtURL,
"/"!=mgmtURL.substr(mgmtURL.length-1)&&(mgmgtURL=mgmtURL+"/"),console.log("CreatePlayerView.activatePlayer. status=301, mgmtURL: "+mgmtURL),setTimeout(J.activatePlayer,1E3))})}}),F=null,S=Backbone.View.extend({el:$("#maindiv"),initialize:function(){F=this},render:function(){var a=d.attributes,a=_.template($("#already_template").html(),a);this.$el.html(a);pendingValidation=!0;formatPage();$("workEmailSend").focus()},events:{"click #sendMeActivationBtn":"sendMeActivationBtnClick","click #sendMeActivationCreateBtn":"sendMeActivationCreateBtnClick",
"input input[type=text]":"resetError","keydown input":"keyDown"},keyDown:function(a){if(13==a.keyCode)return this.sendMeActivationBtnClick(a),!1},resetError:function(a){var b=a.target.id;console.log("event.target.id="+a.target.id);$("#"+b).removeClass("error");$("#"+b+"Err").text("")},sendMeActivationCreateBtnClick:function(a){window.location.hash="createPlayer"},sendMeActivationBtnClick:function(a){$("#workEmailSendErr").text("");$("#workEmailSend").removeClass("error");a=$("#workEmailSend").val();
d.set({workEmail:a,deviceID:"web_default_"+browserType+"_"+a});d.save();var b=!1;""==a?(b=!0,$("#workEmailSendErr").text(l("emptyField")),$("#workEmailSend").addClass("error")):/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)||(b=!0,$("#workEmailSendErr").text(l("invalidWorkEmail")),$("#workEmailSend").addClass("error"));b||this.activatePlayer()},activatePlayer:function(){var a=d.get("workEmail")+
"_"+d.get("deviceID"),a=CryptoJS.HmacSHA1(a,"1981abe0d32d93967648319b013b03f05a119c9f619cc98f");console.log("signature="+a);a=mgmtURL+"activate?deviceid="+encodeURIComponent(d.get("deviceID"))+"&email="+encodeURIComponent(d.get("workEmail"))+"&signature="+encodeURIComponent(a)+"&regid=none&alreadyUser=Y&deviceType=Web&deviceName=Web";console.log("url="+a);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));0==a.status?(d.set({activationKey:a.activationKey}),d.save(),window.location.hash="validation"):
2==a.status?($("#workEmailSendErr").text(l("emailNotExist")),$("#workEmailSend").addClass("error"),$("#sendMeActivationCreateBtn").css("visibility","visible")):3==a.status?(d.set({activationKey:""}),d.save(),window.location.hash="createPlayer"):301==a.status&&(mgmtURL=a.mgmtURL,"/"!=mgmtURL.substr(mgmtURL.length-1)&&(mgmgtURL=mgmtURL+"/"),console.log("AlreadyUserView.activatePlayer. status=301, mgmtURL: "+mgmtURL),setTimeout(F.activatePlayer,1E3))})}}),U=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},
render:function(){var a=_.template($("#auth_template").html(),{userName:"",passwordStr:""});this.$el.html(a);formatPage()},events:{"click #signInBtn":"clickSignIn","input input":"resetError","focus #authPassword":"focusAuthPassword","blur #authPassword":"blurAuthPassword","keydown input":"keyDown"},keyDown:function(a){console.log("keyDown "+a.keyCode);if(-1!=location.hash.localeCompare("#auth")&&13==a.keyCode){var b=a.target.id,c=$("#maindiv").find("input,a,select,button,textarea").filter(":visible"),
b=c.eq(c.index($("#"+b))+1);b.length?b.focus():this.clickSignIn(a);return!1}},resetError:function(a){var b=a.target.id;console.log("event.target.id="+a.target.id);$("#"+b).removeClass("error");$("#"+b+"Err").text("")},focusAuthPassword:function(a){$("input#authPassword").removeAttr("type");$("input#authPassword").prop("type","password")},blurAuthPassword:function(a){a=$("#authPassword").val()==l("passwordStr").trim()?"":$("#authPassword").val();if(null==a||0==a.length)$("input#authPassword").removeAttr("type"),
$("input#authPassword").prop("type","text")},clickSignIn:function(a){$("#authUserNameErr").text("");$("#authUserName").removeClass("error");$("#authPasswordErr").text("");$("#authPassword").removeClass("error");a=$("#authUserName").val()==l("userName").trim()?"":$("#authUserName").val();var b=$("#authPassword").val()==l("passwordStr").trim()?"":$("#authPassword").val(),c=!1;console.log("authUserName="+a);""==a&&(c=!0,$("#authUserNameErr").text(l("emptyField")),$("#authUserName").addClass("error"));
""==b&&(c=!0,$("#authPasswordErr").text(l("emptyField")),$("#authPassword").addClass("error"));c||($("#spinner").show(),document.getElementById("signInBtn").disabled=!0,document.getElementById("authUserName").disabled=!0,document.getElementById("authPassword").disabled=!0,a=mgmtURL+"authenticateUser?loginToken="+encodeURIComponent(loginToken)+"&user="+encodeURIComponent($("#authUserName").val())+"&password="+encodeURIComponent($("#authPassword").val()),getJSON(a,function(a){console.log(JSON.stringify(a,
null,4));$("#spinner").hide();document.getElementById("signInBtn").disabled=!1;document.getElementById("authUserName").disabled=!1;document.getElementById("authPassword").disabled=!1;0==a.status?($("#authPasswordErr").text(l("signIntext2")),$("#authPassword").addClass("error")):1==a.status?(authenticationRequired=!1,window.location.hash=passcodeActivationRequired?"passcodeActivation":"passcode"):2==a.status&&(window.location.hash="validation")},45E3))}}),O=null,V=Backbone.View.extend({el:$("#maindiv"),
changedNode:null,initialize:function(){O=this;savePasscode=enterPasscode="";_.bindAll(this,"on_keypress","on_keydown");$(document).unbind("keypress").bind("keypress",this.on_keypress);$(document).unbind("keydown").bind("keydown",this.on_keydown)},render:function(){var a=mgmtURL+"html/player/";console.log("Called PasscodeView");var b=_.template($("#passcode_template").html(),{});document.getElementById("playerCSS").href=a+"player.css";this.$el.html(b);formatPage()},events:{"click #forgotBtn":"clickForgotBtn",
"mousedown .numKey":"mousedown","mouseup .numKey":"mouseup","mouseout .numKey":"mouseout","click .numKey":"click","click #btndel":"click","touchend .numKey":"click","touchend #btndel":"click","touchend #forgotBtn":"clickForgotBtn"},on_keydown:function(a){a=a.keyCode||a.which;console.log("PasscodeView.on_keydown  code: "+a+", enterPasscode: "+enterPasscode);if(-1!=location.hash.indexOf("passcode")&&(8==a||46==a))return this.deleteChar(),!1},on_keypress:function(a){var b=a.keyCode||a.which;console.log("PasscodeView.on_keypress code: "+
b+" event.type: "+a.type);$("#passcodeErrMsg").css("visibility","hidden");$("#passcodeErrMsg2").css("visibility","hidden");48<=b&&57>=b?(enterPasscode+=String.fromCharCode(b),console.log("PasscodeView. passcode: "+enterPasscode),8<enterPasscode.length?($("#passcodeErrMsg").text(l("noMatchPasscode4")),$("#passcodeErrMsg").css("visibility","visible"),$("#passcodeErrMsg2").text(l("noMatchPasscode5")),$("#passcodeErrMsg2").css("visibility","visible"),enterPasscode=""):$("#enterPasscode").val(enterPasscode)):
8==b||127==b?this.deleteChar():13==b&&this.checkPasscode()},clickForgotBtn:function(a){console.log("PasscodeView. click: "+a.target.id+" type: "+a.type);enterPasscode="";window.location.hash="resetpasscode"},click:function(a){console.log("PasscodeView. click: "+a.target.id+" type: "+a.type);if(1==m.any()&&"click"==a.type)console.log("PasscodeView mobile");else{$("#passcodeErrMsg").css("visibility","hidden");$("#passcodeErrMsg2").css("visibility","hidden");var b=a.target.id;a=enterPasscode;if("keyok"!=
b&&"keydel"!=b&&"btndel"!=b)b=b.substring(3),a+=b;else{if("keydel"==b||"btndel"==b){this.deleteChar();return}if("keyok"==b){this.checkPasscode();return}}enterPasscode=a;0==a.length?$("#enterPasscode").val(""):8>=a.length?$("#enterPasscode").val(enterPasscode):($("#passcodeErrMsg").text(l("noMatchPasscode4")),$("#passcodeErrMsg").css("visibility","visible"),$("#passcodeErrMsg2").text(l("noMatchPasscode5")),$("#passcodeErrMsg2").css("visibility","visible"),enterPasscode="",$("#enterPasscode").val(""))}},
mousedown:function(a){console.log("mousedown");a=a.target.id;"keyok"!=a&&($("#"+a).css("color","#FFFFFF"),this.changedNode=$("#"+a))},mouseup:function(a){null!=this.changedNode&&(this.changedNode.css("color","#333333"),this.changedNode=null)},mouseout:function(a){null!=this.changedNode&&(this.changedNode.css("color","#333333"),this.changedNode=null)},deleteChar:function(){console.log("passcodeView.deleteChar  enterPasscode: "+enterPasscode);1<=enterPasscode.length&&(enterPasscode=enterPasscode.substr(0,
enterPasscode.length-1),console.log("passcodeView.deleteChar  enterPasscode: "+enterPasscode),$("#enterPasscode").val(enterPasscode))},checkPasscode:function(){console.log("passcodeView.checkPasscode  enterPasscode: "+enterPasscode);var a=mgmtURL+"checkPasscode?loginToken="+encodeURIComponent(loginToken)+"&passcode="+encodeURIComponent(enterPasscode);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));0==a.status?($("#passcodeErrMsg").text(l("wrongPassCode1")+"      "+l("wrongPassCode2")),
$("#passcodeErrMsg").css("visibility","visible"),enterPasscode="",$("#enterPasscode").val("")):1==a.status?(loggedIn=!0,window.location.hash="player"):2==a.status?(console.log("expired login token"),n()):4==a.status?(console.log("passcodelock"),window.location.hash="passcodelock"):7==a.status&&(console.log("passcode expired"),passcodeExpired=!0,window.location.hash="setpasscode")})}}),T=Backbone.View.extend({el:$("#maindiv"),changedNode:null,state:0,savedPasscode:"",oldPasscode:"",initialize:function(){this.oldPasscode=
enterPasscode;enterPasscode="";_.bindAll(this,"on_keypress","on_keydown");$(document).unbind("keypress").bind("keypress",this.on_keypress);$(document).unbind("keydown").bind("keydown",this.on_keydown)},render:function(){console.log("Called render");var a=_.template($("#setpasscode_template").html(),{});this.$el.html(a);formatPage();passcodeExpired&&(passcodeExpired=!1,$("#passcodeErrMsg").css("visibility","visible"),$("#passcodeErrMsg").text("your passcode expired"))},events:{"mousedown .numKey":"mousedown",
"mouseup .numKey":"mouseup","mouseout .numKey":"mouseout","click .numKey":"click","click #btndel":"click","touchend .numKey":"click","touchend #btndel":"click"},on_keydown:function(a){a=a.keyCode||a.which;console.log("SetPasscodeView.on_keydown  code: "+a+", enterPasscode: "+enterPasscode);if(-1!=location.hash.indexOf("passcode")&&(8==a||46==a))return this.deleteChar(),$("#selectPasscode").val(enterPasscode),!1},on_keypress:function(a){var b=a.keyCode||a.which;$("#passcodeErrMsg").css("visibility",
"hidden");$("#passcodeErrMsg2").css("visibility","hidden");console.log("setPasscodeView.on_keypress code: "+b+" event.type: "+a.type);48<=b&&57>=b?(enterPasscode+=String.fromCharCode(b),console.log("setPasscodeView. passcode: "+enterPasscode),8<enterPasscode.length?($("#passcodeErrMsg").text(l("noMatchPasscode4")),$("#passcodeErrMsg").css("visibility","visible"),$("#passcodeErrMsg2").text(l("noMatchPasscode5")),$("#passcodeErrMsg2").css("visibility","visible"),enterPasscode="",$("#selectPasscode").val("")):
$("#selectPasscode").val(enterPasscode)):8==b||127==b?(this.deleteChar(),$("#selectPasscode").val(enterPasscode)):13==b&&this.okButton()},click:function(a){console.log("SetPasscodeView. click: "+a.target.id+" type: "+a.type);if(1==m.any()&&"click"==a.type)console.log("PasscodeView mobile");else{$("#passcodeErrMsg").css("visibility","hidden");$("#passcodeErrMsg2").css("visibility","hidden");var b=a.target.id;a=enterPasscode;if("keyok"!=b&&"keydel"!=b&&"btndel"!=b)b=b.substring(3),a+=b;else if("keydel"==
b||"btndel"==b)this.deleteChar(),a=enterPasscode;else if("keyok"==b){this.okButton();return}console.log("setPasscodeView.click   enterPasscode: "+enterPasscode+", passcode: "+a);enterPasscode=a;$("#selectPasscode").trigger("input");0==a.length?$("#selectPasscode").val(""):8>=a.length?$("#selectPasscode").val(enterPasscode):($("#passcodeErrMsg").text(l("noMatchPasscode4")),$("#passcodeErrMsg").css({visibility:"visible"}),$("#passcodeErrMsg2").text(l("noMatchPasscode5")),$("#passcodeErrMsg2").css("visibility",
"visible"),enterPasscode="",$("#selectPasscode").val(""))}},mousedown:function(a){a=a.target.id;"keyok"!=a&&($("#"+a).css("color","#FFFFFF"),this.changedNode=$("#"+a))},mouseup:function(a){null!=this.changedNode&&(this.changedNode.css("color","#333333"),this.changedNode=null)},mouseout:function(a){null!=this.changedNode&&(this.changedNode.css("color","#333333"),this.changedNode=null)},okButton:function(){console.log("SetPasscodeView.okButton  this.state: "+this.state);if(0==this.state)if(6>enterPasscode.length){var a=
l("noMatchPasscode4");$("#passcodeErrMsg").html(a);$("#passcodeErrMsg").css("visibility","visible");a=l("noMatchPasscode7");$("#passcodeErrMsg2").html(a);$("#passcodeErrMsg2").css("visibility","visible");enterPasscode="";$("#selectPasscode").val("")}else this.passcodeValidate(),console.log("SetPasscodeView.okButton  enterPasscode: "+enterPasscode),0!=enterPasscode.length&&(this.savedPasscode=enterPasscode,$("#selectPasscodeTitle").text(l("reEnterPasscode")),this.state=1,enterPasscode="",$("#selectPasscode").val(""));
else enterPasscode!=this.savedPasscode?($("#passcodeErrMsg").text(l("noMatchPasscode1")),$("#passcodeErrMsg").css("visibility","visible"),this.savedPasscode="",this.state=0,$("#selectPasscodeTitle").text(l("selectPasscode")),enterPasscode="",$("#selectPasscode").val("")):this.setPasscode()},passcodeValidate:function(){console.log("SetPasscodeView.passcodeValidate");for(var a=enterPasscode,b="",c,g,d,f=!0,e=0;e<enterPasscode.length-1;e++)c=enterPasscode.substring(e,e+1),g=parseInt(enterPasscode.substring(e,
e+1))+1,d=parseInt(a.substring(e+1,e+2)),g!=d&&(f=!1),-1==b.indexOf(c)&&(b+=c);1==f?($("#passcodeErrMsg").html(l("noMatchPasscode8")),$("#passcodeErrMsg2").html(l("noMatchPasscode81")),$("#passcodeErrMsg").css({visibility:"visible"}),$("#passcodeErrMsg2").css({visibility:"visible"}),enterPasscode="",$("#selectPasscode").val("")):4>b.length&&($("#passcodeErrMsg").html(l("noMatchPasscode9")),$("#passcodeErrMsg").css({visibility:"visible"}),enterPasscode="",$("#selectPasscode").val(""))},setPasscode:function(){var a=
mgmtURL+"setPasscode?loginToken="+encodeURIComponent(loginToken)+"&passcode="+encodeURIComponent(enterPasscode);null!=this.oldPasscode&&0<this.oldPasscode.length&&(a+="&oldpasscode="+encodeURIComponent(this.oldPasscode));console.log(a);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));0==a.status?($("#passcodeErrMsg").text(a.message),$("#passcodeErrMsg").css("visibility","visible"),enterPasscode="",$("#enterPasscode").val(""),this.state=0,$("#selectPasscodeTitle").text(l("selectPasscode"))):
2==a.status?window.location.hash="validation":1==a.status&&(loggedIn=!0,window.location.hash="player")})},deleteChar:function(){console.log("SetPasscodeView.deleteChar  enterPasscode: "+enterPasscode);1<=enterPasscode.length&&(enterPasscode=enterPasscode.substr(0,enterPasscode.length-1),console.log("SetPasscodeView.deleteChar  enterPasscode: "+enterPasscode))}}),L=Backbone.View.extend({el:$("#maindiv"),initialize:function(){$.datepicker.setDefaults({dateFormat:"yy-mm-dd"})},params:{data:[]},render:function(){console.log("Called render");
var a=_.template($("#recordings_template").html(),this.params);this.$el.html(a);formatPage()},events:{"click #homebtn":"homeEvent","click #buttonSearch":"search","click #fromDatepicker":"pickFromDate","click #toDatepicker":"pickToDate","click .buttonCell":"playVideo"},homeEvent:function(a){window.location.hash="validation"},playVideo:function(a){a=a.target.id.split("_");a=this.params.data[Number(a[1])];scale=1E3>a.height?1:2E3>a.height?.5:.3;var b=Math.round(a.width*scale),c=Math.round(a.height*scale);
window.open("login.html#playback/"+loginToken+"/"+b+"/"+c+"/"+scale+"/"+encodeURIComponent(a.filename)+"/"+encodeURIComponent(a.dateObj.toISOString()),"_blank","width="+b+", height="+c)},pickFromDate:function(){$("#fromDatepicker").datepicker({onSelect:function(a){0==$("#toDatepicker").val().length&&$("#toDatepicker").val(a)}});$("#fromDatepicker").datepicker("show")},pickToDate:function(){$("#toDatepicker").datepicker();$("#toDatepicker").datepicker("show")},search:function(a){var b=this,c=$("#fromDatepicker").val()==
l("fromDatepicker").trim()?"":$("#fromDatepicker").val(),g=$("#toDatepicker").val()==l("toDatepicker").trim()?"":$("#toDatepicker").val(),d=$("#searchNames").val()==l("searchNames").trim()?"":$("#searchNames").val(),e=$("#fromSelector").val()==l("fromSelector").trim()?"":$("#fromSelector").val(),p=$("#toSelector").val()==l("toSelector").trim()?"":$("#toSelector").val(),m;if(e==p){m=new Date(new Date(c));m.setDate(m.getDate()+1);a=m.getDate();var n=m.getMonth()+1;m=m.getFullYear()+"-"+("0"+n).slice(-2)+
"-"+("0"+a).slice(-2)}n=a="";null!=c&&c&&null!=g&&g&&(a=c+" "+e,n=null!=m&&m?m+" "+p:g+" "+p);m=mgmtURL+"getNuboRecordings?name="+encodeURIComponent(d)+"&from="+encodeURIComponent(a)+"&to="+encodeURIComponent(n);getJSON(m,function(a){console.log(JSON.stringify(a,null,4));b.params.data=[];if(0==a.status)b.render(),k(c,g,d,e,p);else if(1==a.status){loggedIn=!0;for(i=0;i<a.records.length;i++){var m=new Date(a.records[i].startdate);b.params.data.push({name:a.records[i].displayname,date:m.getMonth()+1+
"/"+m.getDate()+"/"+m.getFullYear(),time:f(m),filename:a.records[i].filename,device:a.records[i].devicename,duration:a.records[i].duration,height:a.records[i].height,width:a.records[i].width,dateObj:m})}b.render();k(c,g,d,e,p)}});this.render();k(c,g,d,e,p)}}),g=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},render:function(){console.log("Called render");var a=_.template($("#resetpasscode_template").html(),{});this.$el.html(a);formatPage()},events:{"click #resetOKBtn":"resetOKBtnClick",
"touchend #resetOKBtn":"resetOKBtnClick","click #resetCancelBtn":"clickResetCancelBtn","touchend #resetCancelBtn":"clickResetCancelBtn"},resetOKBtnClick:function(a){console.log("ResetPasscodeView. click: "+a.target.id+" type: "+a.type);a=mgmtURL+"resetPasscode?loginToken="+encodeURIComponent(loginToken);getJSON(a,function(a){console.log(JSON.stringify(a,null,4));if(0==a.status)window.location.hash="passcode";else if(1==a.status||2==a.status)pendingValidation=!0,window.location.hash="validation"})},
clickResetCancelBtn:function(a){console.log("ResetPasscodeView. click: "+a.target.id+" type: "+a.type);window.location.hash="passcode"}}),E=null,P=Backbone.View.extend({el:$("#maindiv"),initialize:function(){E=this},timeoutId:0,render:function(){console.log("PasscodeLockView.Called render");var a=_.template($("#passcodelock_template").html(),{});this.$el.html(a);formatPage();this.timeoutId=setTimeout(this.checkUnlock,2E3)},events:{"click #resendMailBtn":"clickResend"},clickResend:function(a){var b=
mgmtURL+"resendUnlockPasswordLink?activationKey="+encodeURIComponent(d.get("activationKey"));getJSON(b,function(a){console.log("PasscodeLockView. resendUnlockPassword: "+b+" status: "+a.status);1==a.status?this.timeoutId=setTimeout(this.checkUnlock,2E3):(this.timeoutId=0,window.location.hash="error")})},checkUnlock:function(){var a=mgmtURL+"validate?deviceid="+encodeURIComponent(d.get("deviceID"))+"&activationKey="+encodeURIComponent(d.get("activationKey"))+"&playerVersion="+playerVersion;getJSON(a,
function(a){console.log(JSON.stringify(a,null,4));1==a.status?(this.timeoutId=0,loginToken=a.loginToken,passcodeActivationRequired=a.passcodeActivationRequired,orgName=a.orgName,authType=a.authType,authenticationRequired=a.authenticationRequired,d.set({firstName:a.firstName,lastName:a.lastName,jobTitle:a.jobTitle}),d.save(),window.location.hash=authenticationRequired?"auth":passcodeActivationRequired?"passcodeActivation":"passcode"):0==a.status||4==a.status||301==a.status?(console.log("Unlock pending..."),
301==a.status&&(a=a.mgmtURL,"/"!=a.substr(a.length-1)&&(mgmgtURL=a+"/"),console.log("checkUnlock. status=301, mgmtURL: "+a)),null!=E&&(this.timeoutId=setTimeout(E.checkUnlock,2E3))):2==a.status?(this.timeoutId=0,d.set({activationKey:""}),window.location.hash="expired"):3==a.status&&(this.timeoutId=0,d.set({activationKey:""}),window.location.hash="error")})}}),M=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},timeoutId:0,render:function(){console.log("DisableUserDeviceView.Called render");
var a=_.template($("#disableUserDevice_template").html(),{});this.$el.html(a);formatPage();var b=d.get("adminEmail"),a=d.get("adminName"),c=d.get("orgName"),g=d.get("errorType"),b="<a href=mailto:"+d.get("adminEmail")+">"+b+"</a>";5==g?(g=l("disableDeviceMsg"),g=g.replace("adminName",a),g=g.replace("adminMail",b),g=g.replace("\n","<br/>"),g=g.replace("\n","<br/>"),$("#disableMsg").html(g)):6==g&&(g=l("disableUserMsg"),g=g.replace("adminName",a),g=g.replace("adminMail",b),g=g.replace("compName",c),
g=g.replace("\n","<br/>"),g=g.replace("\n","<br/>"),$("#disableMsg").html(g))}}),ba=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},timeoutId:0,render:function(){console.log("browserVerErrView.Called render");var a=_.template($("#browser_version_error_template").html(),{});this.$el.html(a);formatPage()}}),fa=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},render:function(){var a=_.template($("#connerr_template").html(),{});this.$el.html(a);formatPage()},events:{"click #tryAgainBtn":"tryAgainBtnClick"},
tryAgainBtnClick:function(a){loginToken=null;window.location.hash="validation"}}),ca=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},render:function(){var a=_.template($("#expired_template").html(),{});this.$el.html(a);formatPage()},events:{"click #expiredCreateBtn":"expiredCreateBtnClick"},expiredCreateBtnClick:function(a){d.set({activationKey:""});d.save();window.location.hash="createPlayer"}}),H=null,ga=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},render:function(){var a=
mgmtURL+"html/player/";console.log("PlayerView imgURL: "+a);console.log("PlayerView");a=_.template($("#player_template").html(),{imgURL:a});this.$el.html(a);formatPage();var a=document.getElementById("datadiv"),b=a.offsetWidth,c=a.offsetHeight+(mobilecheck()?90:45);console.log("width: "+b+", height: "+c);H=new UXIP(a,b,c);H.PlayerView=this;a=mgmtURL+"startsession?loginToken="+encodeURIComponent(loginToken);console.log("PlayerView. url: "+a);getJSON(a,function(a){console.log(JSON.stringify(a,null,
4));if(1==a.status){var b=document.createElement("a");b.href=mgmtURL;var c=b.hostname,g=b.protocol,b=b.port;""!=b&&(b=":"+b);c=("http:"==g?"ws://":"wss://")+c+b+"/gatewayProxy?gateway="+encodeURIComponent(a.gateway)+"&port="+a.port+"&isSSL="+a.isSSL;H.connect(c,a.sessionid);a=$("#edVirtualKeyboard");a.off("keypress keydown keyup");a.on("keypress",H.virtualKeyboardEvent);a.on("keydown",H.virtualKeyboardEvent);a.on("keyup",H.virtualKeyboardEvent)}else 2==a.status?(console.log("PlayerView. expired login token"),
window.location.hash="validation"):0==a.status&&(console.log("PlayerView. error"),window.location.hash="error")},1E4)},events:{"click #linkvolcano":"clickHome","click #linksettings":"clickSettings","click #settingsbtn":"clickSearch","click #backbtn":"clickMobileBack","click #recordingsbtn":"openRecordings"},openRecordings:function(a){window.location.hash="recordings"},clickHome:function(a){H.clickHome()},clickSettings:function(a){H.clickSettings()},clickSearch:function(a){H.clickSearch()},clickMobileBack:function(a){console.log("PlayerView. clickMobileBack");
H.clickMobileBack()},setWallpaper:function(a,b){console.log("setWallpaper. type: "+a+", res: "+b);var c,g;0==a?c=WallpaperColorList[parseInt(b)].color:0==b?c=WallpaperImageList[0].image:g=WallpaperImageList[parseInt(b)].image;d.get("activationKey");demoActivation||(d.set({wallpaperColor:c}),d.set({wallpaperImage:g}),d.save());document.getElementById("toolbardiv").style.backgroundColor="#58585A";document.getElementById("datadiv").style.backgroundColor=c;document.getElementById("datadiv").style.backgroundImage=
"url("+mgmtURL+"html/player/"+g+")";document.getElementById("maindiv").style.backgroundColor=c;document.getElementById("maindiv").style.backgroundImage="url("+mgmtURL+"html/player/"+g+")"}}),ha=Backbone.View.extend({el:$("#maindiv"),initialize:function(){},render:function(){console.log("PlaybackView");var a=_.template($("#playback_template").html(),{});this.$el.html(a);formatPage();var a=document.getElementById("datadiv"),b=playbackWidth,c=playbackHeight;$("div#recordingTimeLbl").css("font-size",
20/playbackScale+"px");$("div#recordingTimeLbl").css("width",300/playbackScale+"px");$("div#recordingTimeLbl").css("top",playbackHeight-Math.round(30/playbackScale));console.log("width: "+b+", height: "+c);H=new UXIP(a,b,c,!0);H.PlayerView=this;c=document.createElement("a");c.href=mgmtURL;a=c.hostname;b=c.protocol;c=c.port;""!=c&&(c=":"+c);a=("http:"==b?"ws://":"wss://")+a+c+"/gatewayProxy?playbackMode=Y&fileName="+encodeURIComponent(playbackFile)+"&loginToken="+encodeURIComponent(loginToken);H.connect(a,
"NA")},events:{}});jsonError=function(a,b,c){console.log("Error in JSON. status:"+b+", errorThrown:"+c);window.location.hash="error"};getJSON=function(a,b,c){null==c&&(c=1E4);$.ajax({dataType:"json",url:a,success:b,error:jsonError,timeout:c})};var Q=new (Backbone.Router.extend({routes:{"ppage/:id":"getPlayerPage","activationLink/:token/:email":"getActivationLink","resetPasscodeLink/:token/:email":"getResetPasscodeLink","unlockPassword/:token/:email":"getUnlockPassword",downloadApp:"getDownloadApp",
"downloadApp/:domain":"getDownloadApp","*actions":"defaultRoute"}})),B=new AppController;Q.on("route:getPlayerPage",function(a){loggedIn?console.log("Player page "+a):window.location.hash="validation"});Q.on("route:getDownloadApp",function(a){console.log("route:getDownloadApp. ");e();var b=new u;b.domain=a;B.showView(b)});Q.on("route:getActivationLink",function(a,b){console.log("route:getActivationLink. token:"+a+", email:"+b);e();var c=new x;c.token=a;c.email=b;B.showView(c)});Q.on("route:getResetPasscodeLink",
function(a,b){console.log("route:getResetPasscodeLink. token:"+a+", email:"+b);e();var c=new N;c.token=a;c.email=b;B.showView(c)});Q.on("route:getUnlockPassword",function(a,b){console.log("route:getUnlockPassword. token:"+a+", email:"+b);e();var c=new G;c.token=a;c.email=b;B.showView(c)});Q.on("route:defaultRoute",function(a){console.log("route:defaultRoute. actions:"+a);var b=get_browser_version();if("firefox"==browserType&&28>b||"chrome"==browserType&&35>b||"ie"==browserType&&11>b)console.log("browser type: "+
browserType+", browser version: "+b),a=new ba,B.showView(a);else if(e(),b=d.get("activationKey"),"resetActivation"==a)console.log("resetActivation.*****"),wallpaperColor="#58585A",wallpaperImage="",d.set({activationKey:"",firstName:"",lastName:"",jobTitle:"",workEmail:"",wallpaperImage:"",wallpaperColor:wallpaperColor,uploadExternalWallpaper:!0,deviceID:""}),d.save(),window.location.hash="greeting";else if("error"==a)a=new fa,B.showView(a);else if("expired"==a)a=new ca,B.showView(a);else if("passcodelock"==
a)a=new P,B.showView(a);else if("disableUserDevice"==a)a=new M,B.showView(a);else if("browserVerError"==a)a=new ba,B.showView(a);else if(null!=b&&10<b.length)if("validation"==a)demoActivation?(console.log("DEMO.  actions: greeting"),d.set({activationKey:""}),d.save(),a=new y):a=new c,B.showView(a);else if(null==loginToken)if(a&&1==a.startsWith("playback/")){a=a.split("/");console.log("playback actions :"+a);loginToken=a[1];var b=Number(a[2]),f=Number(a[3]),m=Number(a[4]);playbackWidth=b/m;playbackHeight=
f/m;playbackScale=m;playbackFile=a[5];playbackStartTime=Date.parse(a[6]);console.log("width: "+b+"px");$("div#maindiv").css("width",b+"px");$("div#maindiv").css("height",f+"px");$("div#maindiv").css("-webkit-transform","scale("+m+")");$("div#maindiv").css("transform-origin","top left");$("body").css("overflow-x","hidden");$("body").css("overflow-y","hidden");loggedIn=!0;window.location.hash="playback"}else window.location.hash="validation";else"auth"==a&&authenticationRequired?(a=new U,B.showView(a)):
"setpasscode"==a?(a=new T,B.showView(a)):"passcodeActivation"==a&&passcodeActivationRequired&&!authenticationRequired?(a=new T,B.showView(a)):"passcode"!=a||authenticationRequired||passcodeActivationRequired?"resetpasscode"!=a||authenticationRequired||passcodeActivationRequired?"recordings"==a&&loggedIn?(a=new L,B.showView(a)):"playback"==a&&loggedIn?(a=new ha,B.showView(a)):"player"==a&&loggedIn?(a=new ga,B.showView(a)):window.location.hash="validation":(a=new g,B.showView(a)):(a=new V,B.showView(a));
else"createPlayer"==a?(a=new K,B.showView(a)):"greeting"==a?(a=new y,B.showView(a)):"already"==a?(a=new S,B.showView(a)):window.location.hash="greeting"});0==Backbone.History.started&&Backbone.history.start()});function NuboCache(e){var f={},k=[],d;this.addCacheItem=function(m,n,u){var y=f[m.toString()];if(null==y){y={};if(11<=k.length){var b=k.shift();e(b)}k.push(m.toString());f[m.toString()]=y;d=m}else d!=m&&(d=m,b=k.indexOf(m.toString()),k.splice(b,1),k.push(m.toString()));y[n]=u};this.removeCacheItems=function(d,e){f[d.toString()].splice(0,e)};this.getCacheItem=function(d,e){var k=(f[d.toString()]||{})[e];null==k&&(isNodeJS?console.error("NuboCache could not find cache item for process="+d+" cacheItemHashCodeStr="+
e):Log.e("NuboCache","could not find cache item for process="+d+" cacheItemHashCodeStr="+e));return k};this.clearAckedProcessCache=function(d){delete f[d.toString()]}}var isNodeJS;"undefined"!=typeof module&&(module.exports={NuboCache:NuboCache},isNodeJS=!0);var psDisconnect=0,psInit=1,psConnected=2,psDisconnecting=3,psError=4,keyboardProcessID=0,START_ROUND_TRIP_CHECK=!0,RTT_THRESHOLD_TO_CLOSE_SOCKET=2500,mBadRTTCounter=0,MAX_BAD_RTT_SEQUENCE=5,WRITE_TRANSACTION_TIMEOUT=9E5,SOCKET_READ_TIMEOUT=3E4,TAG="UXIP",DEBUG_PROTOCOL_NETWORK=!1,DEBUG_PROTOCOL_NETWORK_STR="_NETWORK",DEBUG_DRAW_COMMANDS_STR="DRAW_CMD",PRINT_DRAW_COMMANDS=!1,PRINT_NETWORK_COMMANDS=!1,writeToDrawCmdLog=!1;
function UXIP(e,f,k,d,m){function n(){var a=(new Date).getTime()-Ba;console.log("checkTimeOut");a>WRITE_TRANSACTION_TIMEOUT&&(Log.e(TAG+" WRITE_TRANSACTION_TIMEOUT"),C(),window.location.reload())}function u(a,b){b||(b=0);var D={},c="",g=0,d;for(d in a){var h=a[d];"string"==typeof h?h="'"+h+"'":"object"==typeof h&&(h=h instanceof Array?"[ "+h+" ]":"{ "+u(h,b+1).dump+" }");for(var c=c+"\n",f=0;f<b;f++)c+="  ";c+="'"+d+"' : "+h+", ";g++}D.dump=c.replace(/, $/,"");D.len=g;return D}function y(a){return{name:"nuboFloat",
val:a}}var b=this,c=psDisconnect,p={},x=null,A=null,N=new ZlibReader,I,G,C,J,K,F,S,U,O,V,T,L,g,E,P,M,ba,fa,ca,H,ga,ha,Q,B,a,q,ta,ua,aa,va,wa,xa,ya,za,Aa,Ca,Da,Ea,R,ma,Fa,Ga,Ha,na,Ia,Ja,Ka,La,Ma,Na,Oa,ia,oa,pa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,qa,ra,Ya,Za,w=new UXIPWriter(function(a){x.send(a)}),$a=new NuboCache(function(a){w.notifyClearProcessCache(a)}),h=new UXIPReader($a),ja,z,ka=!1,sa=this,Ba=0,ab=0,da=0,r={},bb=0,cb=0,db,ea=[];p.connect=function(a,b){ja=b;console.log("connecting to "+a+", sessID: "+
ja);var D=document.createElement("a");D.href=a;var t=D.hostname,g=D.protocol,D=D.port;""!=D&&(D=":"+D);t=("ws:"==g?"http://":"https://")+t+D;db=t+"/html/player/";z=new WindowManager(e,f,k-45,sa,b,t);N.ondata=function(a){h.addBuffer(a);W||(DEBUG_PROTOCOL_NETWORK&&Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"inside draw command. will not call handle_message()"),I())};x=new WebSocket(a,["binary"]);x.binaryType="arraybuffer";NuboOutputStreamMgr.getInstance().createSocket(e,f,k,sa,w);x.onmessage=function(a){DEBUG_PROTOCOL_NETWORK&&
Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"onmessage, e.data.byteLength="+a.data.byteLength);ab=(new Date).getTime();for(N.addBuffer(a.data);N.handle_message();)PRINT_NETWORK_COMMANDS&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"Handled block....")};x.onopen=function(){DEBUG_PROTOCOL_NETWORK&&Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"websocket open");c==psDisconnect?(bb=(new Date).getTime(),d?c=psConnected:F()):(Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"Unexpected websocket open"),x.close());null!=da&&clearInterval(da);
da=setInterval(n,12E3)};x.onclose=function(a){var b="";a.code&&(b=" (code: "+a.code,a.reason&&(b+=", reason: "+a.reason),b+=")");Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"WebSocket on-close event "+b);null!=da&&clearInterval(da);c=psDisconnect;d||z.killAll()};x.onerror=function(a){var b="";a.code&&(b=" (code: "+a.code,a.reason&&(b+=", reason: "+a.reason),b+=")");Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"WebSocket on-error event "+b)}};this.keyEvent=function(a,b,c,t){if("keypress"==a.type)a=null==a.which?
String.fromCharCode(a.keyCode):0!=a.which&&0!=a.charCode?String.fromCharCode(a.which):null,la&&(t=$("#edVirtualKeyboard").val(),console.log('newText: "'+t+'" , oldInputText: "'+X+'"')," "==a&&1<t.length-X.length&&(a=t.substr(X.length)),X=t,console.log("#edVirtualKeyboard: "+t+", chr: "+a)),null!=a&&(console.log("chr: "+a),R(b,c,{name:"KeyEvent",action:KeyEvent.ACTION_MULTIPLE,keyCode:KeyEvent.KEYCODE_UNKNOWN,characters:a}));else{t=-1;var g=null==a.which?a.keyCode:a.which;console.log("key: "+g);switch(g){case 8:t=
KeyEvent.KEYCODE_DEL;break;case 9:t=KeyEvent.KEYCODE_TAB;break;case 13:t=KeyEvent.KEYCODE_ENTER;break;case 17:t=KeyEvent.KEYCODE_ALT_LEFT;break;case 18:t=KeyEvent.KEYCODE_CTRL_LEFT;break;case 27:t=KeyEvent.KEYCODE_ESCAPE;break;case 32:t=KeyEvent.KEYCODE_SPACE;break;case 33:t=KeyEvent.KEYCODE_PAGE_UP;break;case 34:t=KeyEvent.KEYCODE_PAGE_DOWN;break;case 35:t=KeyEvent.KEYCODE_MOVE_END;break;case 36:t=KeyEvent.KEYCODE_MOVE_HOME;break;case 37:t=KeyEvent.KEYCODE_DPAD_LEFT;break;case 38:t=KeyEvent.KEYCODE_DPAD_UP;
break;case 39:t=KeyEvent.KEYCODE_DPAD_RIGHT;break;case 40:t=KeyEvent.KEYCODE_DPAD_DOWN;break;case 46:t=KeyEvent.KEYCODE_FORWARD_DEL;break;case 91:t=KeyEvent.KEYCODE_BUTTON_START;break;case 112:t=KeyEvent.KEYCODE_F1;break;case 113:t=KeyEvent.KEYCODE_F2;break;case 114:t=KeyEvent.KEYCODE_F3;break;case 115:t=KeyEvent.KEYCODE_F4;break;case 116:t=KeyEvent.KEYCODE_F5;break;case 117:t=KeyEvent.KEYCODE_F6;break;case 118:t=KeyEvent.KEYCODE_F7;break;case 119:t=KeyEvent.KEYCODE_F8;break;case 120:t=KeyEvent.KEYCODE_F9;
break;case 121:t=KeyEvent.KEYCODE_F10;break;case 122:t=KeyEvent.KEYCODE_F11;break;case 123:t=KeyEvent.KEYCODE_F12;break;case 144:t=KeyEvent.KEYCODE_NUM_LOCK}0<t&&(console.log("specialKey: "+t),a.preventDefault(),R(b,c,{name:"KeyEvent",action:"keydown"==a.type?KeyEvent.ACTION_DOWN:KeyEvent.ACTION_UP,keyCode:t}))}return!0};this.protocolState=function(){return c};var Y,Z;this.mouseEvent=function(a){var b=a.lastMouseDownTouchTime;Log.d(TAG,"mouseEvent. event.type = "+a.type+" lastMouseDownTouchTime="+
b);var c=a.src,t=c.getBoundingClientRect(),g=a.clientX-t.left-c.clientLeft+c.scrollLeft,c=a.clientY-t.top-c.clientTop+c.scrollTop;Log.v(TAG,"mouseEvent.  type="+a.type+", timeStamp="+a.timeStamp+", left="+g+", top="+c);w.writeBoolean(!1);t={hi:0,lo:0};w.writeLong(t);w.writeLong(t);w.writeInt(1);var d;"mouseup"==a.type?(Z=Y=null,d=1):"mousedown"==a.type?(Y=g,Z=c,d=0):"mousemove"==a.type&&(d=2);w.writeInt(d);w.writeInt(0);w.writeInt(1);2!=d&&(w.writeFloat(0),w.writeFloat(90),w.writeFloat(90),w.writeFloat(90),
w.writeFloat(90));w.writeFloat(.73);w.writeFloat(.26);w.writeFloat(g);w.writeFloat(c);w.writeFloat(2);w.writeFloat(2);2!=d?(w.writeInt(0),w.writeInt(0),w.writeInt(0),w.writeInt(4098),w.writeInt(0)):(a=(new Date).getTime()-b,b=(c-Z)/a,w.writeFloat((g-Y)/a),w.writeFloat(b));return!0};this.touchEvent=function(a){var b=a.lastMouseDownTouchTime,c=a.src,t=c.getBoundingClientRect();w.writeBoolean(!1);var g={hi:0,lo:0};w.writeLong(g);w.writeLong(g);console.log("eventt.touches.length: "+a.touches.length+", eventt.changedTouches: "+
a.changedTouches.length);w.writeInt(a.changedTouches.length);var d;"touchend"==a.type||"touchcancel"==a.type?(Z=Y=null,d=1):"touchstart"==a.type?d=0:"touchmove"==a.type&&(d=2);w.writeInt(d);for(g=0;g<a.changedTouches.length;g++){var h=a.changedTouches[g];console.log("touch.identifier: "+h.identifier);w.writeInt(g);w.writeInt(1)}for(g=0;g<a.changedTouches.length;g++){var h=a.changedTouches[g],f=h.clientX-t.left-c.clientLeft+c.scrollLeft,e=h.clientY-t.top-c.clientTop+c.scrollTop;"touchstart"==a.type&&
0==g&&(Y=f,Z=e);Log.v(TAG,"touchPoint.  type="+a.type+", timeStamp="+a.timeStamp+", left="+f+", top="+e+", force:"+h.force);w.writeFloat(0);w.writeFloat(h.force?h.force:.73);w.writeFloat(.26);w.writeFloat(90);w.writeFloat(90);w.writeFloat(90);w.writeFloat(90);w.writeFloat(f);w.writeFloat(e)}w.writeInt(0);w.writeInt(0);w.writeFloat(2);w.writeFloat(2);w.writeInt(0);w.writeInt(4098);w.writeInt(0);2==d&&(a=(new Date).getTime()-b,e=(e-Z)/a,w.writeFloat((f-Y)/a),w.writeFloat(e));console.log("WRITE OLD");
return!0};C=function(){c=psError;x.close()};G=function(){DEBUG_PROTOCOL_NETWORK&&Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"calling more data");I()};var la=function(){var a=!1,b=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4)))a=!0;return a}();F=function(){c=psInit;console.log("sessid="+ja);var a=y(163);la&&(a=y(326));var g=y(1),D=a,t=RomClientType.WEB,t=Modernizr.webp?t|RomClientType.ROM_IMAGES_WEBP:t|RomClientType.ROM_IMAGES_PNG,t=la?t|RomClientType.ROM_HW_KEYBOARD_NONE:t|RomClientType.ROM_HW_KEYBOARD_EXISTS,d;d=NuboOutputStreamMgr.getInstance().getWithService()?b.nuboByte(PlayerCmd.playerLogin):PlayerCmd.playerLogin;NuboOutputStreamMgr.getInstance().setIsPlayerLogin(!0);NuboOutputStreamMgr.getInstance().sendCmd(d,
123456,ja,f,k,163,D,a,g,0,0,0,0,t,17,"web","1.2.0.55","1.2",55,4*k*f,-1,"");NuboOutputStreamMgr.getInstance().setIsPlayerLogin(!1)};I=function(){if(!ka)switch(c){case psDisconnect:d?h.canReadBytes(4)?K()&&G():(console.log("Got data while disconnect playback mode but finished all data!!!!"),z.killAll()):console.log("Got data while disconnect or error");break;case psDisconnecting:case psError:console.log("Got data while disconnect or error");break;case psConnected:K()&&h.canReadBytes(4)&&G();break;
default:J()&&h.canReadBytes(4)&&G()}};J=function(){if(!h.canReadBytes(4))return Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"Invalid init response size. waiting"),!1;if(h.readInt()!=DrawCmd.drawPlayerLoginAck)return Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"cmd is not drawPlayerLoginAck. terminating..."),C(),!1;if(!h.canReadBytes(4))return h.rollback(4),!1;var a=h.readInt();if(0>a)return Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"Error happend on gateway. Errno:  "+a),C(),!1;DEBUG_PROTOCOL_NETWORK&&Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,
"Loggedin.");c=psConnected;return!0};var W=!1;K=function(){if(W)return Log.e(TAG,"Calling getDrawCommand while running..."),!1;W=!0;var b=!1;try{var c=13;d&&(c+=4);if(!h.canReadBytes(c))return DEBUG_PROTOCOL_NETWORK&&Log.d(TAG,"Too short draw command header. waiting..."),W=!1;DEBUG_PROTOCOL_NETWORK&&h.printState("start getDrawCommand");r={};h.beginTransaction();var D=h.readInt(),t=h.readInt(),f=h.readByte(),e=h.readInt(),v;v=d?h.readInt():0;writeToDrawCmdLog&&(r.bytesCount=D,r.processId=t,r.cmdcode=
f,r.cmdName=drawCmdCodeToText(f),r.wndId=e,Log.v(TAG,"drawCmdLog.cmdName: "+r.cmdName+", cmdcode: "+f));if(D>c&&!h.canReadBytes(D-c))return DEBUG_PROTOCOL_NETWORK&&Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"insufficient buffer. Rollback..."),h.rollbackTransaction(),W=!1;if(0<v){var k=(new Date).getTime(),c=k-bb;if(c<v)return D=v-c+1,Log.v(TAG,"Sleeping for "+D+" ms"),h.rollbackTransaction(),b=!0,setTimeout(function(){W=!1;I()},D),!1;if(500<k-cb){cb=k;var m=new Date(playbackStartTime+v);$("#recordingTimeLbl").text(m.toLocaleDateString()+
" "+m.toLocaleTimeString())}}v=null;DEBUG_PROTOCOL_NETWORK&&h.printState("after header read");switch(f){case DrawCmd.setDirtyRect:v=ba;break;case DrawCmd.writeTransaction:Ba=(new Date).getTime();v=fa;break;case DrawCmd.drawColor1:v=ca;break;case DrawCmd.saveLayer:v=H;break;case DrawCmd.restoreLayer:v=ga;break;case DrawCmd.drawText:v=ha;break;case DrawCmd.drawText1:v=Q;break;case DrawCmd.drawRect:v=B;break;case DrawCmd.drawBitmap:v=a;break;case DrawCmd.saveLayerAlpha:v=q;break;case DrawCmd.drawColor2:v=
ca;break;case DrawCmd.drawLine:v=ta;break;case DrawCmd.drawLines:v=ua;break;case DrawCmd.drawRect1:v=B;break;case DrawCmd.drawRoundRect:v=B;break;case DrawCmd.drawBitmap1:v=aa;break;case DrawCmd.setDensity:v=va;break;case DrawCmd.drawTextRun:v=Pa;break;case DrawCmd.ninePatchDraw:v=wa;break;case DrawCmd.drawBitmap6:v=xa;break;case DrawCmd.drawPosText1:v=ya;break;case DrawCmd.drawPosText2:v=za;break;case DrawCmd.drawBitmap8:v=Aa;break;case DrawCmd.drawBitmapMatrix:v=Oa;break;case DrawCmd.popWindow:v=
U;break;case DrawCmd.pushWindow:v=O;break;case DrawCmd.setWndId:v=V;break;case DrawCmd.showWindow:v=T;break;case DrawCmd.hideWindow:v=L;break;case DrawCmd.wallpaperID:v=g;break;case DrawCmd.toggleSearch:v=E;break;case DrawCmd.toggleMenu:v=P;break;case DrawCmd.showSoftKeyboard:v=Ja;break;case DrawCmd.prepKeyboardLayout:v=S;break;case DrawCmd.removeProcess:v=Fa;break;case DrawCmd.incomingNotification:v=Ca;break;case DrawCmd.wallpaperOffset:v=Da;break;case DrawCmd.initPopupContentView:v=Ea;break;case DrawCmd.updatePopWindow:v=
Ka;break;case DrawCmd.drawWebView:v=Ga;break;case DrawCmd.resizeWindow:v=La;break;case DrawCmd.sendKeyboardExtractedText:v=Ma;break;case DrawCmd.updateScreenOrientation:v=Na;break;case DrawCmd.prepareViewCache:v=Ra;break;case DrawCmd.roundTripDataAck:v=Sa;break;case DrawCmd.outgoingCall:v=Ta;break;case DrawCmd.drawPath:v=Ua;break;case DrawCmd.toast:case DrawCmd.oldToast:v=Va;break;case DrawCmd.setTopTask:v=Wa;break;case DrawCmd.setWindowPos:v=Xa;break;case DrawCmd.clearProcessCacheAck:v=Ya;break;
case DrawCmd.setPackageName:v=Za;break;default:Log.e(TAG,"processId="+t+", cmdcode="+f+", wndId="+e);Log.e(TAG,"Illegal draw command "+f);var p=h.getTransactionSize();0<D-p&&h.incrementOffsetAfterRead(D-p);h.compact();return!0}if(null!=v)try{DEBUG_PROTOCOL_NETWORK&&Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"Before running func: "+f);if(v(t,e,f)){p=h.getTransactionSize();if(p!=D){Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,"Error read incorrect number of bytes. required: "+D+", actual: "+p);if(p>D)return C(),
!1;h.incrementOffsetAfterRead(D-p)}DEBUG_PROTOCOL_NETWORK&&h.printState("before compact");h.compact();DEBUG_PROTOCOL_NETWORK&&h.printState("after compact");writeToDrawCmdLog&&console.log(u(r).dump);return!0}DEBUG_PROTOCOL_NETWORK&&(Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"processId="+t+", cmdcode="+f+", cmdName="+drawCmdCodeToText(f)+", wndId="+e),Log.d(TAG+DEBUG_PROTOCOL_NETWORK_STR,"insufficient buffer. Rollback..."));h.rollbackTransaction();return!1}catch(n){return Log.e(TAG+DEBUG_PROTOCOL_NETWORK_STR,
"Error during draw command "+drawCmdCodeToText(f)+" err: "+n),p=h.getTransactionSize(),0<D-p&&h.incrementOffsetAfterRead(D-p),h.compact(),!0}else Log.e(TAG,"What the func?")}finally{b||(W=!1)}};ba=function(a,b){var c=h.readRect();if(!c.canRead)return!1;PRINT_DRAW_COMMANDS&&Log.d(TAG,"setDirtyRect. processId="+a+", wndId="+b+", rect="+JSON.stringify(c));z.setDirtyRect(a,b,c);writeToDrawCmdLog&&(r.rect=c);return!0};fa=function(a,b){z.writeTransaction(a,b);return!0};ca=function(a,b,c){PRINT_DRAW_COMMANDS&&
Log.d(TAG,"drawColor1. processId="+a+", wndId="+b);var g=h.readBoundsAndMatrix();if(!g.canRead||!h.canReadBytes(4))return!1;var d=h.readInt(),e=1;if(c!=DrawCmd.drawColor2){if(!h.canReadBytes(1))return!1;e=h.readByte()}writeToDrawCmdLog&&(r.bm=g,r.color=d,r.mode=e);a=z.prepareCanvasForPaint(a,b,g);if(null==a)return!0;0==e?a.clearRect(0,0,f,k):(d="#"+d.toString(16),a.fillStyle=d,a.fillRect(0,0,f,k));a.restore();return!0};H=function(a,b){var c=h.readPaint(a);if(!c.canRead||!h.canReadBytes(1))return!1;
var g=h.readByte();Log.e("AsiM","saveLayer. processId="+a+", wndId="+b+", saveFlags="+g);z.saveLayerAlpha(a,b,255);writeToDrawCmdLog&&(r.paintRes=c,r.saveFlags=g);return!0};ga=function(a,b){PRINT_DRAW_COMMANDS&&Log.d(TAG,"restoreLayer. processId="+a+", wndId="+b);z.restoreLayer(a,b);return!0};pa=function(a,b){var c="NuboRoboto";"/system/fonts/AndroidClock.ttf"==b.fontPath&&(c="AndroidClock");var g="";switch(b.typefaceStyle){case Typeface.NORMAL:g="";break;case Typeface.BOLD:g="bold ";break;case Typeface.BOLD_ITALIC:g=
"italic bold ";break;case Typeface.ITALIC:g="italic "}a.font=g+b.textSize+"px "+c;c="#"+b.color.toString(16);a.fillStyle=c;switch(b.textAlign){case Align.LEFT:a.textAlign="left";break;case Align.CENTER:a.textAlign="center";break;case Align.RIGHT:a.textAlign="right"}};ia=function(a,b,c,g,d){pa(a,d);1!=d.textScaleX&&0<d.textScaleX?(a.scale(.9*d.textScaleX,1),a.fillText(b,1/(.9*d.textScaleX)*c,g)):a.fillText(b,c,g)};oa=function(a,b,c,g,d){pa(a,d);if(c instanceof Array&&g instanceof Array)if(d=0,d=c.length>
g.length?g.length:c.length,null!=b&&b.length>=d)for(var h=0;h<d;h++)a.fillText(b[h],c[h],g[h]);else Log.e(TAG,"drawPosTextOnCanvas:: incorrect text input. text = "+b+" minLength = "+d);else if(c instanceof Array)if(null!=b&&b.length>=c.length)for(h=0;h<c.length;h++)a.fillText(b[h],c[h],g);else Log.e(TAG,"drawPosTextOnCanvas:: incorrect text input. text = "+b+" posX.length = "+c.length);else if(g instanceof Array)if(null!=b&&b.length>=g.length)for(h=0;h<g.length;h++)a.fillText(b[h],c,g[h]);else Log.e(TAG,
"drawPosTextOnCanvas:: incorrect text input. text = "+b+" posY.length = "+g.length);else Log.e(TAG,"drawPosTextOnCanvas:: unimplemented command")};Q=function(a,b,c){c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readCachedString(a);if(!g.canRead)return!1;g=g.value;if(!h.canReadBytes(16))return!1;var d=h.readInt(),f=h.readInt(),g=g.substring(d,f),f=h.readFloat(),e=h.readFloat(),p=h.readPaint(a);if(!p.canRead)return!1;p=p.p;writeToDrawCmdLog&&(r.bm=c,r.text=g,r.start=d,r.x=f,r.y=e,r.paint=
p);a=z.prepareCanvasForPaint(a,b,c);if(null==a)return!0;if(null==p)return Log.e(TAG,"Null paint!"),!0;ia(a,g,f,e,p);a.restore();return!0};ha=function(a,b,c){c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readCachedString(a);if(!g.canRead)return!1;g=g.value;if(!h.canReadBytes(8))return!1;var d=h.readFloat(),f=h.readFloat(),e=h.readPaint(a);if(!e.canRead)return!1;e=e.p;writeToDrawCmdLog&&(r.bm=c,r.text=g,r.x=d,r.y=f,r.paint=e);a=z.prepareCanvasForPaint(a,b,c);if(null==a)return!0;if(null==
e)return Log.e(TAG,"Null paint!"),!0;ia(a,g,d,f,e);a.restore();return!0};Pa=function(a,b,c){c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readCachedString(a);if(!g.canRead)return!1;g=g.value;if(!h.canReadBytes(16))return!1;var d=h.readInt(),f=h.readInt(),f=d+f,g=g.substring(d,f),e=h.readFloat(),p=h.readFloat(),k=h.readPaint(a);if(!k.canRead)return!1;k=k.p;writeToDrawCmdLog&&(r.bm=c,r.text=g,r.start=d,r.end=f,r.x=e,r.y=p,r.paint=k);a=z.prepareCanvasForPaint(a,b,c);if(null==a)return!0;if(null==
k)return Log.e(TAG,"Null paint!"),!0;ia(a,g,e,p,k);a.restore();return!0};qa=function(a){return"rgba("+((a&16711680)>>>16)+","+((a&65280)>>>8)+","+(a&255)+","+(a>>>24)/255+")"};ra=function(a,b,c){if(null!=a&&1<a)for(var g=b.length<a.length?b.length:a.length,d=0;d<g;d++){var h=qa(b[d]);c.addColorStop(a[d],h)}else for(a=1/b.length,d=g=0;1>d;d+=a)h=qa(b[g++]),c.addColorStop(d,h)};B=function(a,b,c){var g=h.readBoundsAndMatrix();if(!g.canRead||!h.canReadBytes(5))return!1;var d=h.readRectF();if(!d.canRead)return!1;
var f=Math.round(d.left),e=Math.round(d.top),p=Math.round(d.right),k=Math.round(d.bottom),m=0,n=0;if(c==DrawCmd.drawRoundRect){if(!h.canReadBytes(8))return!1;m=h.readFloat();n=h.readFloat();Log.e("drawRoundRect. rx:"+m+", ry:"+n)}c=h.readPaint(a);if(!c.canRead)return!1;if(null==c.p||f>=p||e>=k||g.bounds.left>=g.bounds.right||g.bounds.top>=g.bounds.bottom||k<g.bounds.top||g.bounds.bottom<e||p<g.bounds.left||g.bounds.right<f)return!0;e<g.bounds.top&&(e=g.bounds.top);k>g.bounds.bottom&&(k=g.bounds.bottom);
f<g.bounds.left&&(f=g.bounds.left);p>g.bounds.right&&(p=g.bounds.right);c=c.p;var x=null;writeToDrawCmdLog&&(r.bm=g,r.rect=d,r.rx=m,r.ry=n,r.paint=c);d=z.prepareCanvasForPaint(a,b,g);if(null==d)return!0;if(null!=c.shader){if(c.shader.stype==ShaderType.LinearGradient)return x=c.shader.x0,a=c.shader.y0,b=c.shader.x1,g=c.shader.y1,null!=c.shader.localMatrix&&null!=c.shader.localMatrix.arr&&(g=c.shader.localMatrix.arr,x=c.shader.x0*g[0]+c.shader.y0*g[3]+g[2],a=c.shader.x0*g[1]+c.shader.y0*g[4]+g[5],b=
c.shader.x1*g[0]+c.shader.y1*g[3]+g[2],g=c.shader.x1*g[1]+c.shader.y1*g[4]+g[5],Log.e("LinearGradient with localMatrix: "+x+","+a+","+b+",",g)),d.rect(f,e,p-f,k-e),x=d.createLinearGradient(x,a,b,g),ra(c.shader.positions,c.shader.colors,x),d.fillStyle=x,d.fill(),d.restore(),!0;if(c.shader.stype==ShaderType.BitmapShader){var m=c.shader.bitmap,n=c.shader.tileX,E=c.shader.tileY;1==n&&1==E||Log.e(TAG,"BitmapShader:: unimplemented tile types. tileX = "+n+" tileY = "+E);M(a,b,g,null,null,c.shader.localMatrix,
c,m,0,0,null,DrawBitmapType.bitmapShader)}else c.shader.stype==ShaderType.RadialGradient&&(x=d.createRadialGradient(c.shader.x,c.shader.y,0,c.shader.x,c.shader.y,Math.sqrt(c.shader.x*c.shader.x+c.shader.y*c.shader.y)),ra(c.shader.positions,c.shader.colors,x))}a=d.fillStyle;b=d.strokeStyle;g=d.globalAlpha;m="#"+c.color.toString(16);null==x?(d.fillStyle=m,d.strokeStyle=m):(d.fillStyle=x,d.strokeStyle=x);d.rect(f,e,p-f,k-e);d.globalAlpha=c.alpha/255;c.style!=Style.FILL&&c.style!=Style.FILL_AND_STROKE||
d.fill();c.style!=Style.STROKE&&c.style!=Style.FILL_AND_STROKE||d.stroke();d.restore();d.globalAlpha=g;d.fillStyle=a;d.strokeStyle=b;return!0};var eb=null;Ga=function(a,b){if(!h.canReadBytes(4))return!1;var c=h.readInt();if(6!=c&&7==c){c=h.readWebViewBitmap();if(!c.canRead)return!1;eb=c.bitmap}c=h.readBoundsAndMatrix();if(!c.canRead)return!1;Log.e("drawWebView. bm="+JSON.stringify(c));M(a,b,c,null,null,null,null,eb,0,0,null,DrawBitmapType.webView);return!0};M=function(a,b,c,g,d,h,f,e,p,k,m,x){var n=
document.createElement("img");PRINT_DRAW_COMMANDS&&Log.d(TAG,"drawBitmapIntoCanvas. bitmap.bitmapType: "+e.bitmapType+", drawBitmapType: "+x);n.onload=function(f){f=z.prepareCanvasForPaint(a,b,c);if(null!=f){if(x==DrawBitmapType.ninePatch)Ha(f,d,n,m);else if(x==DrawBitmapType.webView){var e=z.getWindow(a,b);e.bounds.bottom+e.matrix.arr[5]==n.height?(f={isNull:!1},f.bounds={isNull:!1,left:e.matrix.arr[2],top:e.matrix.arr[5],right:e.bounds.right+e.matrix.arr[2],bottom:e.bounds.bottom+e.matrix.arr[5]},
f.matrix={isNull:!1},f.matrix.arr=[1,0,0,0,1,0,0,0,1],Log.e("webView out of mem case! sn.bounds:"+JSON.stringify(e.bounds)+", sn.matrix:"+JSON.stringify(e.matrix)+", img.height="+n.height+", newbm:"+JSON.stringify(f)),f=z.prepareCanvasForPaint(a,b,f)):Log.e("webView std case! sn.bounds:"+JSON.stringify(e.bounds)+", sn.matrix:"+JSON.stringify(e.matrix)+", img.height="+n.height);f.drawImage(n,0,0)}else x==DrawBitmapType.bitmapShader?(null==h||h.isNull||f.setTransform(h.arr[0],h.arr[3],h.arr[1],h.arr[4],
h.arr[2],h.arr[5]),e=f.createPattern(n,"repeat"),f.fillStyle=e,e=z.getWindow(a,b),f.fillRect(0,0,e.canvas.width,e.canvas.height)):x==DrawBitmapType.drawBitmapMatrix?(null==h||h.isNull||f.setTransform(h.arr[0],h.arr[3],h.arr[1],h.arr[4],h.arr[2],h.arr[5]),f.drawImage(n,p,k)):null==g||null==d?f.drawImage(n,p,k):g.isNull?f.drawImage(n,d.left,d.top,d.right-d.left,d.bottom-d.top):f.drawImage(n,g.left,g.top,g.right-g.left>n.width?n.width:g.right-g.left,g.bottom-g.top>n.height?n.height:g.bottom-g.top,d.left,
d.top,d.right-d.left,d.bottom-d.top);f.restore()}ka=!1;G()};n.onerror=function(a){Log.e(TAG,"Error on loading image ");ka=!1;G()};if("res"==e.bitmapType)n.crossOrigin="Anonymous",n.setAttribute("src",db+e.path);else{f=new Uint8Array(e.data);e="";for(var E=0;E<f.length;E++)e+=String.fromCharCode(f[E]);f=btoa(e);x==DrawBitmapType.ninePatch?n.setAttribute("src","data:image/png;base64,"+f):Modernizr.webp?n.setAttribute("src","data:image/webp;base64,"+f):n.setAttribute("src","data:image/png;base64,"+f)}ka=
!0};a=function(a,b){PRINT_DRAW_COMMANDS&&Log.d(TAG,"drawBitmap. processId="+a+", wndId="+b);var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readBitmapCache(a);if(!g.canRead)return!1;var d=h.readRect();if(!d.canRead)return!1;var f=h.readRect();if(!f.canRead)return!1;var e=h.readPaint(a);if(!e.canRead)return!1;e=e.p;if(g.retVal==NuboStatus.FAIL)return Log.e(TAG,"drawBitmap: bitmap could not be retrieved"),!0;g=g.bitmap;M(a,b,c,d,f,null,e,g,0,0,null,DrawBitmapType.stdBitmap);writeToDrawCmdLog&&
(r.bm=c,r.src=d,r.dst=f,r.paint=e,r.bitmap=g);return!0};q=function(a,b){if(!h.canReadBytes(2))return!1;var c=h.readByte(),g=h.readByte();z.saveLayerAlpha(a,b,c);writeToDrawCmdLog&&(r.alpha=c,r.saveFlags=g);return!0};ta=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead||!h.canReadBytes(16))return!1;var g=h.readFloat(),d=h.readFloat(),f=h.readFloat(),e=h.readFloat(),p=h.readPaint(a);if(!p.canRead)return!1;p=p.p;if(null!=p){c=z.prepareCanvasForPaint(a,b,c);if(null==c)return!0;p="#"+p.color.toString(16);
c.fillStyle=p;c.beginPath();c.moveTo(g,d);c.lineTo(f,e);c.stroke();c.restore();return!0}};ua=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readFloatArr();if(!g.canRead||!h.canReadBytes(8))return!1;var d=h.readInt(),f=h.readInt(),e=h.readPaint(a);if(!e.canRead)return!1;e=e.p;if(null!=e){if(0==c.bounds.left&&0==c.bounds.right&&0==c.bounds.top&&0==c.bounds.bottom)return!0;c=z.prepareCanvasForPaint(a,b,c);if(null==c)return!0;e="#"+e.color.toString(16);c.fillStyle=e;for(e=
d;e+3<d+f&&e+3<g.arr.length;e+=4)c.beginPath(),c.moveTo(g.arr[e],g.arr[e+1]),c.lineTo(g.arr[e+2],g.arr[e+3]),c.stroke();c.restore();return!0}};aa=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readBitmapCache(a);if(!g.canRead||!h.canReadBytes(8))return!1;var d=h.readFloat(),e=h.readFloat(),f=h.readPaint(a);if(!f.canRead)return!1;f=f.p;if(!g.retVal==NuboStatus.FAIL)return Log.e(TAG,"drawBitmap: bitmap could not be retrieved"),!0;g=g.bitmap;writeToDrawCmdLog&&(r.bm=c,r.left=
d,r.top=e,r.paint=f,r.bitmap=g);M(a,b,c,null,null,null,f,g,d,e,null,DrawBitmapType.stdBitmap);return!0};va=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead||!h.canReadBytes(4))return!1;var g=h.readInt();writeToDrawCmdLog&&(r.bm=c,r.density=g);PRINT_DRAW_COMMANDS&&Log.d(TAG,"setDensity. processId="+a+", wndId="+b+", density="+g);c=z.prepareCanvasForPaint(a,b,c);if(null==c)return!0;c.restore();return!0};na=function(a,b,c,g,d){return c*(a-b-d)/g};Ha=function(a,b,c,g){var d={},e={},f=g.numXDivs,
h=g.numYDivs,p,k,m=0,n,x,E=0==g.xDivs[0],P=0==g.yDivs[0],u=c.width,q=c.height,r=a.fillStyle,A=a.globalAlpha,y=[],M=!1,w=0;for(p=0;p<f;p+=2)w+=g.xDivs[p+1]-g.xDivs[p];var C=u-w,z=0;for(p=0;p<h;p+=2)z+=g.yDivs[p+1]-g.yDivs[p];var aa=q-z;e.top=0;d.top=b.top;for(k=P?1:0;k<=h&&e.top<q;k++,P=!P){e.left=0;d.left=b.left;k==h?(e.bottom=q,d.bottom=b.bottom):(e.bottom=g.yDivs[k],p=e.bottom-e.top,P?(d.bottom=d.top+na(b.bottom,d.top,p,z,aa),z-=p):(d.bottom=d.top+p,aa-=p));for(p=(x=E)?1:0;p<=f&&e.left<u;p++,x=
!x){n=g.colors[m++];if(p==f)e.right=u,d.right=b.right;else if(e.right=g.xDivs[p],M)d.right=y[p];else{var B=e.right-e.left;x?(d.right=d.left+na(b.right,d.left,B,w,C),w-=B):(d.right=d.left+B,C-=B);y[p]=d.right}if(e.left>=e.right)e.left=e.right;else{B=!0;if(d.right<=d.left||d.bottom<=d.top)B=!1;B&&Ia(a,e,d,c,0,n);e.left=e.right;d.left=d.right}}e.top=e.bottom;d.top=d.bottom;M=!0}a.globalAlpha=A;a.fillStyle=r};Ia=function(a,b,c,g,d,e){a.drawImage(g,b.left,b.top,b.right-b.left,b.bottom-b.top,c.left,c.top,
c.right-c.left,c.bottom-c.top)};wa=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readRect();if(!g.canRead)return!1;var d=h.readBitmapCache(a);if(!d.canRead)return!1;var e=h.readNinePatchChunkCache(a);if(!e.canRead)return!1;var f=d.bitmap,p=e.data;if(null==p)return Log.e("mChunk is null!"),!0;var e={},k=new DataView(p,0);e.numXDivs=k.getUint8(1);e.numYDivs=k.getUint8(2);e.numColors=k.getUint8(3);e.paddingLeft=k.getInt32(12);e.paddingRight=k.getInt32(16);e.paddingTop=k.getInt32(20);
e.paddingBottom=k.getInt32(24);e.xDivs=new Int32Array(p,32,e.numXDivs);e.yDivs=new Int32Array(p,32+4*e.numXDivs,e.numYDivs);e.colors=new Uint32Array(p,32+4*e.numXDivs+4*e.numYDivs,e.numColors);if(!h.canReadBytes(8))return!1;p=h.readInt();k=h.readInt();if(d.retVal==NuboStatus.FAIL)return Log.v(TAG,"NinePatchDraw1: bitmap could not be retrieved"),!0;M(a,b,c,null,g,null,null,f,0,0,e,DrawBitmapType.ninePatch);writeToDrawCmdLog&&(r.bm=c,r.location=g,r.bitmap=f,r.chunk=e,r.bitmapDensity=p,r.canvasDensity=
k);return!0};xa=function(a,b){Log.e(TAG,"drawBitmap6. processId="+a+", wndId="+b);return!0};ya=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readCachedString(a);if(!g.canRead)return!1;var g=g.value,d=h.readCachedFloatArray(a);if(!d.canRead)return!1;var d=d.floatArr,e=h.readCachedFloatArray(a);if(!e.canRead)return!1;var e=e.floatArr,f=h.readPaint(a);if(!f.canRead)return!1;f=f.p;c=z.prepareCanvasForPaint(a,b,c);if(null==c)return!0;if(null==f)return Log.e(TAG,"drawPosText2::Null paint!"),
!0;oa(c,g,d,e,f);c.restore();return!0};za=function(a,b){var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readCachedString(a);if(!g.canRead)return!1;var g=g.value,d=h.readCachedFloatArray(a);if(!d.canRead)return!1;d=d.floatArr;if(!h.canReadBytes(4))return!1;var e=h.readFloat(),f=h.readPaint(a);if(!f.canRead)return!1;f=f.p;c=z.prepareCanvasForPaint(a,b,c);if(null==c)return!0;if(null==f)return Log.e(TAG,"drawPosText2::Null paint!"),!0;oa(c,g,d,e,f);c.restore();return!0};Aa=function(a,b){PRINT_DRAW_COMMANDS&&
Log.d(TAG,"drawBitmap8. processId="+a+", wndId="+b);var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readBitmapCache(a);if(!g.canRead)return!1;var d=h.readRect();if(!d.canRead)return!1;var e=h.readRectF();if(!e.canRead)return!1;var f=h.readPaint(a);if(!f.canRead)return!1;f=f.p;if(g.retVal==NuboStatus.FAIL)return Log.e(TAG,"drawBitmap8: bitmap could not be retrieved"),!0;g=g.bitmap;M(a,b,c,d,e,null,f,g,0,0,null,DrawBitmapType.stdBitmap);writeToDrawCmdLog&&(r.bm=c,r.src=d,r.dst=e,r.paint=
f,r.bitmap=g);return!0};Oa=function(a,b){PRINT_DRAW_COMMANDS&&Log.d(TAG,"drawBitmapMatrix. processId="+a+", wndId="+b);var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readBitmapCache(a);if(!g.canRead)return!1;var d=h.readMatrix();if(!d.canRead)return!1;var e=h.readPaint(a);if(!e.canRead)return!1;e=e.p;if(g.retVal==NuboStatus.FAIL)return Log.v(TAG,"drawBitmapMatrix: bitmap could not be retrieved"),!0;g=g.bitmap;M(a,b,c,null,null,d,e,g,0,0,null,DrawBitmapType.drawBitmapMatrix);writeToDrawCmdLog&&
(r.bm=c,r.matrix=d,r.paint=e,r.bitmap=g);return!0};Ua=function(a,b){PRINT_DRAW_COMMANDS&&Log.d(TAG,"drawPath. processId="+a+", wndId="+b);var c=h.readBoundsAndMatrix();if(!c.canRead)return!1;var g=h.readCachedPath(a);if(!g.canRead)return!1;var g=g.path,d=h.readPaint(a);if(!d.canRead)return!1;c=z.prepareCanvasForPaint(a,b,c);c.beginPath();for(var d=d.p,e=c.fillStyle,f=c.strokeStyle,p=c.globalAlpha,k="#"+d.color.toString(16),m=0,n=g.points,x=g.segmentMask,E=0;E<g.verbs.length;E++)switch(g.verbs[E]){case 0:c.moveTo(n[2*
m],n[2*m+1]);m++;break;case 1:0!=(x&1)&&c.lineTo(n[2*m],n[2*m+1]);m++;break;case 2:0!=(x&2)&&c.quadraticCurveTo(n[2*m],n[2*m+1],n[2*m+2],n[2*m+3]);m+=2;break;case 3:0!=(x&4)&&c.bezierCurveTo(n[2*m],n[2*m+1],n[2*m+2],n[2*m+3],n[2*m+4],n[2*m+5]);m+=3;break;case 4:c.closePath();break;case 5:break;default:Log.e(TAG,"Wrong verb type "+Verbs[E]+" of point "+E)}c.fillStyle=k;c.strokeStyle=k;c.globalAlpha=d.alpha/255;if(d.style==Style.FILL||d.style==Style.FILL_AND_STROKE)g.FillType==Path.FillType.WINDING?
c.fill("nonzero"):g.FillType==Path.FillType.EVEN_ODD?c.fill("evenodd"):c.fill();d.style!=Style.STROKE&&d.style!=Style.FILL_AND_STROKE||c.stroke();c.globalAlpha=p;c.fillStyle=e;c.strokeStyle=f;c.restore();return!0};E=function(){if(!h.canReadBytes(1))return!1;h.readBoolean();return!0};P=function(){if(!h.canReadBytes(1))return!1;h.readBoolean();return!0};Ja=function(a,c){if(!h.canReadBytes(1))return!1;var g=h.readBoolean();Log.e(TAG,"showSoftKeyboard. processId="+a+", wndId="+c+", show="+g);NuboOutputStreamMgr.getInstance().sendCmd(b.nuboByte(PlayerCmd.setKeyboardState),
a,g);keyboardProcessID=a;if(g){Log.e(TAG,"open edVirtualKeyboard");$(window).scroll(function(){console.log("$( window ).scrollTop(): "+$(window).scrollTop())});$("#edVirtualKeyboard").css({top:Z,left:Y,position:"fixed"});var d=document.querySelector("#edVirtualKeyboard");(function(){window.setTimeout(function(){d.value=d.value||"";console.log("input focus");d.focus()},200)})();NuboOutputStreamMgr.getInstance().sendCmd(b.nuboByte(PlayerCmd.setKeyboardHeight),a,k/2)}else console.log("Hide soft keyboard"),
$("#edVirtualKeyboard").blur();return!0};Va=function(a,b){var c=h.readCachedString(a);if(!c.canRead)return!1;c=c.value;if(!h.canReadBytes(4))return!1;var g=h.readInt();0==g?new Android_Toast({content:"<em>"+c+"</em>",duration:2E3}):1==g&&new Android_Toast({content:"<em>"+c+"</em>",duration:3500});return!0};g=function(){if(!h.canReadBytes(8))return!1;var a=h.readInt(),b=h.readInt();Log.v(TAG,"setWallpaperByID.  type="+a+", res="+b);p.PlayerView.setWallpaper(a,b);return!0};T=function(a,b){z.showWindow(a,
b);return!0};L=function(a,b){z.hideWindow(a,b);return!0};V=function(a,b){if(!h.canReadBytes(4))return!1;var c=h.readInt();PRINT_DRAW_COMMANDS&&Log.d(TAG,"setWndId. wndId="+b+", nuboWndId="+c);z.updateWndId(a,b,c);return!0};U=function(a,b){PRINT_DRAW_COMMANDS&&Log.d(TAG,"PopWindow. processId="+a+", wndId="+b);var c=b;if(!h.canReadBytes(4))return!1;c=h.readInt();z.removeWindowFromStack(a,c)&&(c=z.getLastNotKeyboardProcessIdOnStack(keyboardProcessID),isNaN(c)||0==c?Log.e(TAG,"popWindow:: there is no last processId"):
A=c);return!0};O=function(a,b){if(!h.canReadBytes(5))return!1;PRINT_DRAW_COMMANDS&&Log.d(TAG,"Push window. wndId="+b+", processId="+a);var c=h.readInt(),g=h.readByte();g!=ContainerType.ACTIVITY&&g!=ContainerType.DIALOG||a==A||(A=a);var d=0,e=0,f=0,p=0,k=0,m=!1,n=-1,x=-1;if(g==ContainerType.POPUPWINDOW){if(!h.canReadBytes(21))return!1;f=h.readInt();d=h.readInt();e=h.readInt();p=h.readByte();k=h.readInt();x=h.readInt()}else{if(g==ContainerType.ACTIVITY){if(!h.canReadBytes(5))return!1}else{if(!h.canReadBytes(6))return!1;
m=h.readByte()}p=h.readByte();n=h.readInt()}z.pushWndOnStack(a,b,c,g,f,d,e,m,p,k,n,x);writeToDrawCmdLog&&(Log.d(TAG,"PushWindow succeeded. processId="+a+", wndId="+b+", nuboWndId="+c+", containerType: "+g),r.nuboWndId=c,r.containerType=g,r.gravity=f,r.x=d,r.y=e,r.orientation=p,r.taskIdAndPos=n);return!0};var X="";S=function(a,b){Log.e(TAG,"prepKeyboardLayout.");PRINT_DRAW_COMMANDS&&Log.d(TAG,"prepKeyboardLayout. processId="+a+", wndId="+b);if(!h.canReadBytes(8))return!1;h.readInt();h.readInt();if(!h.readCachedString(a).canRead||
!h.readCachedString(a).canRead||!h.canReadBytes(3))return!1;h.readByte();h.readByte();h.readBoolean();var c=h.readCachedString(a);if(!c.canRead)return!1;la&&(console.log("prepKeyboardLayout. text: "+c.value),$("#edVirtualKeyboard").val(c.value),$("#edVirtualKeyboard").setCursorPosition(c.value.length),X=c.value,null==X&&(X=""));return!0};Ca=function(a,b){return h.readString().canRead?h.readBitmapCache(-2).canRead?!0:(Log.e(TAG,"!bitmapRet.canRead"),!1):!1};Da=function(){if(!h.canReadBytes(4))return!1;
h.readFloat();return!0};Ea=function(a,b){if(!h.canReadBytes(16))return!1;var c=h.readInt(),g=h.readInt(),d=h.readInt(),e=h.readInt();Log.e(TAG,"initPopupContentView. onScreenX="+c+", onScreenY="+g+", decorHeight="+d+", decorWidth="+e);z.clearPopupCanvas(a,b,c,g);return!0};Ka=function(a,b){if(!h.canReadBytes(17))return!1;var c=h.readInt(),g=h.readInt(),d=h.readInt(),e=h.readInt(),f=h.readBoolean();Log.e(TAG,"updatePopWindow. onScreenX="+c+", onScreenY="+g+", decorHeight="+d+", decorWidth="+e+", force:"+
f);return!0};Fa=function(a,b){Log.e(TAG,"removeProcess. processId="+a+", keyEvent="+b);z.removeProcess(a);var c=z.getLastNotKeyboardProcessIdOnStack(keyboardProcessID);isNaN(c)||0==c?Log.e(TAG,"removeProcess:: there is no last processId"):A=c;return!0};ma=function(a,b){Log.e(TAG,"dispatchKeyEvent. processId="+a+", keyEvent="+b+", protocolState: "+c);c==psConnected&&NuboOutputStreamMgr.getInstance().sendCmd(b,a)};p.close=function(){x.close()};p.clickHome=function(){console.log("clickHome.");if(c==
psConnected){ma(A,b.nuboByte(PlayerCmd.homeKeyEvent));for(var a=0;a<ea.length;a++)if("com.nubo.launcher"!=ea[a].packName){var g=z.getWindow(ea[a].processId,0);null!=g&&(console.log("clickHome. wndId: "+g.wndId),L(ea[a].processId,g.wndId))}}};p.clickSearch=function(){console.log("clickSearch.");c==psConnected&&ma(A,b.nuboByte(PlayerCmd.searchKeyEvent))};p.clickMobileBack=function(){console.log("clickMobileBack.");if(c==psConnected){var a=z.getWindow(A,0);null!=a&&(R(A,a.wndId,{name:"KeyEvent",action:KeyEvent.ACTION_DOWN,
keyCode:KeyEvent.KEYCODE_BACK}),R(A,a.wndId,{name:"KeyEvent",action:KeyEvent.ACTION_UP,keyCode:KeyEvent.KEYCODE_BACK}))}};this.clickBack=function(){console.log("clickBack.");if(c==psConnected){var a=z.getWindow(A,0);null!=a&&(R(A,a.wndId,{name:"KeyEvent",action:KeyEvent.ACTION_DOWN,keyCode:KeyEvent.KEYCODE_BACK}),R(A,a.wndId,{name:"KeyEvent",action:KeyEvent.ACTION_UP,keyCode:KeyEvent.KEYCODE_BACK}))}};p.virtualKeyboardEvent=function(a){a=a||event;if(c==psConnected){var b=z.getWindow(A,0);if(null!=
b)return sa.keyEvent(a,A,b.wndId,this)}};p.clickSettings=function(){if(c==psConnected){var a=z.getWindow(A,0);null!=a&&(R(A,a.wndId,{name:"KeyEvent",action:KeyEvent.ACTION_DOWN,keyCode:KeyEvent.KEYCODE_MENU}),R(A,a.wndId,{name:"KeyEvent",action:KeyEvent.ACTION_UP,keyCode:KeyEvent.KEYCODE_MENU}))}};R=function(a,g,d){Log.e(TAG,"handleKeyEvent. processId="+a+", wndId="+g);c==psConnected&&NuboOutputStreamMgr.getInstance().sendCmd(b.nuboByte(PlayerCmd.keyEvent),a,g,d)};START_ROUND_TRIP_CHECK&&!d&&setInterval(function(){Qa(A,
-1)},1E3);Qa=function(a,g){if(c==psConnected){var d=(new Date).getTime();d-ab>SOCKET_READ_TIMEOUT?(Log.e(TAG+" SOCKET_READ_TIMEOUT"),C()):NuboOutputStreamMgr.getInstance().sendCmd(b.nuboByte(PlayerCmd.roundTripData),a,g,{name:"nuboLongAsFloat",val:d})}};this.nuboByte=function(a){return{name:"nuboByte",val:a}};Sa=function(){var a=h.readLongAsFloat(),a=(new Date).getTime()-a;!d&&a>RTT_THRESHOLD_TO_CLOSE_SOCKET?(mBadRTTCounter++,mBadRTTCounter>=MAX_BAD_RTT_SEQUENCE&&(Log.e(TAG,"BAD RoundTripData, "+
mBadRTTCounter+" times of RTT > "+RTT_THRESHOLD_TO_CLOSE_SOCKET),mBadRTTCounter=0,C())):mBadRTTCounter=0;return!0};Na=function(){if(!h.canReadBytes(1))return!1;var a=h.readByte();writeToDrawCmdLog&&(r.orientation=a);return!0};Ya=function(a){$a.clearAckedProcessCache(a);return!0};Za=function(a){var b=h.readCachedString(a);if(!b.canRead)return!1;b=null==b.value?"":b.value;0<b.length&&ea.push({processId:a,packName:b});return!0};Ra=function(a,b){var c=h.readBitmapCache(a);if(!c.canRead)return!1;c.retVal==
NuboStatus.FAIL&&Log.e(TAG,"prepareViewCache: bitmap could not be retrieved");return!0};Ma=function(a,b){return h.readCachedString(a).canRead?!0:!1};La=function(a,b){if(!h.canReadBytes(1))return!1;h.readByte();Log.e(TAG,"resizeWindow. Should have rotated window");var c=z.getWindow(a,b);if(null==c)return Log.e(TAG,"resizeWindow. processId = "+a+" dosent exist im wm"),!0;c=c.containerType;c!=ContainerType.ACTIVITY&&c!=ContainerType.DIALOG||a==A||(A=a);return!0};Ta=function(a,b){h.readCachedString(a);
h.readCachedString(a);return!0};Wa=function(){if(!h.canReadBytes(4))return!1;var a=h.readInt();PRINT_DRAW_COMMANDS&&Log.d(TAG,"setTopTask. taskId = "+a);z.moveTaskToTop(a);return!0};Xa=function(a,b){if(!h.canReadBytes(4))return!1;var c=h.readInt();z.updateWndTaskPos(a,b,c);return!0};return p}var RomClientType={ANDROID:0,IOS:1,WEB:2,ROM_IMAGES_WEBP:0,ROM_IMAGES_PNG:256,ROM_IMAGES_JPG:512,ROM_IMAGES_MASK:3840,ROM_HW_KEYBOARD_NONE:0,ROM_HW_KEYBOARD_EXISTS:4096};function Consts(){}
Consts.TEMP_WINDOW_ID=12345;function Log(){}Log.v=function(e,f){console.log("["+e+"] "+f)};Log.e=function(e,f){console.error("["+e+"] "+f)};Log.d=function(e,f){console.info("["+e+"] "+f)};function ContainerType(){}ContainerType.ACTIVITY=1;ContainerType.DIALOG=2;ContainerType.POPUPWINDOW=4;ContainerType.DEFAULT=8;function PlayerCmd(){}PlayerCmd.sync=-1;PlayerCmd.touchEvent=1;PlayerCmd.keyEvent=2;PlayerCmd.playerLogin=3;PlayerCmd.playerDisconnected=4;PlayerCmd.switchUser=5;
PlayerCmd.setKeyboardHeight=6;PlayerCmd.platformProcessConnected=7;PlayerCmd.setKeyboardState=8;PlayerCmd.clearProcessCache=14;PlayerCmd.roundTripData=17;PlayerCmd.homeKeyEvent=20;PlayerCmd.notificationCancel=21;PlayerCmd.searchKeyEvent=22;PlayerCmd.notificationOpen=23;PlayerCmd.requestState=24;function drawCmdCodeToText(e){for(var f in DrawCmd)if(DrawCmd[f]==e)return f;return e}function DrawCmd(){}DrawCmd.setDirtyRect=1;DrawCmd.drawColor1=2;DrawCmd.saveLayer=3;DrawCmd.restoreLayer=4;
DrawCmd.drawText=5;DrawCmd.drawText1=6;DrawCmd.drawRect=7;DrawCmd.drawBitmap=8;DrawCmd.saveLayerAlpha=9;DrawCmd.drawColor2=10;DrawCmd.drawLine=11;DrawCmd.drawLines=12;DrawCmd.drawRect1=13;DrawCmd.drawRoundRect=14;DrawCmd.drawBitmap1=15;DrawCmd.setDensity=16;DrawCmd.drawTextRun=17;DrawCmd.ninePatchDraw=18;DrawCmd.drawBitmap6=19;DrawCmd.drawPosText1=20;DrawCmd.drawPosText2=21;DrawCmd.drawBitmap8=22;DrawCmd.drawPlayerLoginAck=23;DrawCmd.oldToast=24;DrawCmd.drawBitmapMatrix=25;DrawCmd.drawPath=26;
DrawCmd.drawPoints=27;DrawCmd.countLocationUpdates=28;DrawCmd.setPackageName=29;DrawCmd.toast=83;DrawCmd.IMMEDIATE_COMMAND=100;DrawCmd.writeTransaction=101;DrawCmd.pushWindow=102;DrawCmd.popWindow=103;DrawCmd.showWindow=104;DrawCmd.hideWindow=105;DrawCmd.drawWebView=106;DrawCmd.showSoftKeyboard=107;DrawCmd.prepKeyboardLayout=108;DrawCmd.removeProcess=109;DrawCmd.setWndId=110;DrawCmd.initPopupContentView=111;DrawCmd.updatePopWindow=112;DrawCmd.wallpaperOffset=113;DrawCmd.toggleMenu=114;
DrawCmd.toggleSearch=115;DrawCmd.wallpaperID=116;DrawCmd.incomingNotification=117;DrawCmd.resizeWindow=118;DrawCmd.sendKeyboardExtractedText=119;DrawCmd.updateScreenOrientation=120;DrawCmd.clearProcessCacheAck=121;DrawCmd.prepareViewCache=122;DrawCmd.roundTripDataAck=123;DrawCmd.outgoingCall=124;DrawCmd.setTopTask=125;DrawCmd.setWindowPos=126;function DrawBitmapType(){}DrawBitmapType.stdBitmap=0;DrawBitmapType.ninePatch=1;DrawBitmapType.webView=2;DrawBitmapType.drawBitmapMatrix=3;
DrawBitmapType.bitmapShader=4;function NuboStatus(){}NuboStatus.OK=0;NuboStatus.FAIL=-1;function BitmapSendRcvType(){}BitmapSendRcvType.fullBitmap=1;BitmapSendRcvType.cachedBitmap=2;BitmapSendRcvType.resourceBitmap=3;BitmapSendRcvType.assetBitmap=4;function PathSendRcvType(){}PathSendRcvType.fullPath=1;PathSendRcvType.cachedPath=2;function Path(){}Path.FillType={WINDING:0,EVEN_ODD:1,INVERSE_WINDING:2,INVERSE_EVEN_ODD:3};function FloatArrSendRcvType(){}FloatArrSendRcvType.fullArray=1;
FloatArrSendRcvType.cachedArray=2;function Typeface(){}Typeface.BOLD=1;Typeface.BOLD_ITALIC=3;Typeface.ITALIC=2;Typeface.NORMAL=0;function Style(){}Style.FILL=0;Style.STROKE=1;Style.FILL_AND_STROKE=2;function Cap(){}Cap.BUTT=0;Cap.ROUND=1;Cap.SQUARE=2;function Join(){}Join.MITER=0;Join.ROUND=1;Join.BEVEL=2;function Align(){}Align.LEFT=0;Align.CENTER=1;Align.RIGHT=2;function Paint(){}Paint.ANTI_ALIAS_FLAG=1;Paint.FILTER_BITMAP_FLAG=2;Paint.DITHER_FLAG=4;Paint.UNDERLINE_TEXT_FLAG=8;
Paint.STRIKE_THRU_TEXT_FLAG=16;Paint.FAKE_BOLD_TEXT_FLAG=32;Paint.LINEAR_TEXT_FLAG=64;Paint.SUBPIXEL_TEXT_FLAG=128;Paint.DEV_KERN_TEXT_FLAG=256;function KeyEvent(){}KeyEvent.ACTION_DOWN=0;KeyEvent.ACTION_UP=1;KeyEvent.ACTION_MULTIPLE=2;KeyEvent.SOURCE_KEYBOARD=257;KeyEvent.KEYCODE_HOME=3;KeyEvent.KEYCODE_BACK=4;KeyEvent.KEYCODE_MENU=82;KeyEvent.KEYCODE_UNKNOWN=0;KeyEvent.KEYCODE_DEL=67;KeyEvent.KEYCODE_FORWARD_DEL=112;KeyEvent.KEYCODE_ENTER=66;KeyEvent.KEYCODE_F1=131;KeyEvent.KEYCODE_F2=132;
KeyEvent.KEYCODE_F3=133;KeyEvent.KEYCODE_F4=134;KeyEvent.KEYCODE_F5=135;KeyEvent.KEYCODE_F6=136;KeyEvent.KEYCODE_F7=137;KeyEvent.KEYCODE_F8=138;KeyEvent.KEYCODE_F9=139;KeyEvent.KEYCODE_F10=140;KeyEvent.KEYCODE_F11=141;KeyEvent.KEYCODE_F12=142;KeyEvent.KEYCODE_NUM_LOCK=143;KeyEvent.KEYCODE_MOVE_HOME=122;KeyEvent.KEYCODE_MOVE_END=123;KeyEvent.KEYCODE_CTRL_LEFT=113;KeyEvent.KEYCODE_CTRL_RIGHT=114;KeyEvent.KEYCODE_ESCAPE=111;KeyEvent.KEYCODE_PAGE_UP=92;KeyEvent.KEYCODE_PAGE_DOWN=93;
KeyEvent.KEYCODE_DPAD_UP=19;KeyEvent.KEYCODE_DPAD_DOWN=20;KeyEvent.KEYCODE_DPAD_LEFT=21;KeyEvent.KEYCODE_DPAD_RIGHT=22;KeyEvent.KEYCODE_ALT_LEFT=57;KeyEvent.KEYCODE_ALT_RIGHT=58;KeyEvent.KEYCODE_SHIFT_LEFT=59;KeyEvent.KEYCODE_SHIFT_RIGHT=60;KeyEvent.KEYCODE_TAB=61;KeyEvent.KEYCODE_BUTTON_START=108;KeyEvent.KEYCODE_SPACE=62;function Res_png_9patch(){}Res_png_9patch.NO_COLOR=1;Res_png_9patch.TRANSPARENT_COLOR=0;function CacheDataType(){}CacheDataType.bitmap=1;CacheDataType.ninepatchBitmap=2;
CacheDataType.ninepatchChunk=3;function ShaderType(){}ShaderType.LinearGradient=1;ShaderType.BitmapShader=2;ShaderType.RadialGradient=3;UXIPExport={UXIP:UXIP,Paint:Paint,Style:Style,Cap:Cap,Join:Join,Align:Align,Typeface:Typeface,DrawCmd:DrawCmd,KeyEvent:KeyEvent,PlayerCmd:PlayerCmd,FloatArrSendRcvType:FloatArrSendRcvType};"undefined"!=typeof module&&(module.exports=UXIPExport,UTF8=require("./utf8.js").UTF8,NuboCache=require("./nubocache.js").NuboCache);
new function(e){e.fn.setCursorPosition=function(f){if(this.setSelectionRange)this.setSelectionRange(f,f);else if(this.createTextRange){var k=this.createTextRange();k.collapse(!0);0>f&&(f=e(this).val().length+f);k.moveEnd("character",f);k.moveStart("character",f);k.select()}}}(jQuery);function UXIPReader(e){var f=[],k=0,d=0,m=null,n=0;if(null==u)var u=!1;this.getBuffArr=function(){return f};this.getBuffIdx=function(){return k};this.getOffset=function(){return d};this.beginTransaction=function(){n=0};this.rollbackTransaction=function(){this.rollback(n);n=0};this.getTransactionSize=function(){return n};this.addBuffer=function(b){f.push(b);k+1==f.length&&(m=new DataView(f[k],0))};this.printState=function(b){Log.v("Reader",b+" reader state: buffArr.length:"+f.length+", bufIdx:"+k+
". offset:"+d)};this.compact=function(){if(1024<=d){var b=f[k];f[k]=new ArrayBuffer(b.byteLength-d);(new Uint8Array(f[k])).set((new Uint8Array(b)).subarray(d),0);d=0;m=new DataView(f[k],0)}0!=k&&(f.splice(0,k),k=0)};this.canReadBytes=function(b){if(f.length<=k)return!1;if(f[k].byteLength>=d+b)return!0;if(f.length>k+1){var c=f[k+1],e=f[k];f.splice(k+1,1);f[k]=new ArrayBuffer(e.byteLength+c.byteLength);var n=new Uint8Array(f[k]);n.set(new Uint8Array(e),0);n.set(new Uint8Array(c),e.byteLength);m=new DataView(f[k],
0);return this.canReadBytes(b)}return!1};this.incrementOffsetAfterRead=function(b){d+=b;n+=b;d>=f[k].byteLength&&(k++,d=0,f.length>k&&(m=new DataView(f[k],0)))};this.readChar=function(){var b=m.getUint16(d);this.incrementOffsetAfterRead(2);return String.fromCharCode(b)};this.readInt=function(){var b=m.getInt32(d);this.incrementOffsetAfterRead(4);return b};this.readUInt32=function(){var b=m.getUint32(d);this.incrementOffsetAfterRead(4);return b};this.readLong=function(){var b={};b.hi=m.getUint32(d);
b.lo=m.getUint32(d+4);this.incrementOffsetAfterRead(8);return b};this.readLongAsFloat=function(){var b=m.getFloat64(d);this.incrementOffsetAfterRead(8);return b};this.readInt16=function(){var b=m.getInt16(d);this.incrementOffsetAfterRead(2);return b};this.readFloat=function(){var b=m.getFloat32(d);this.incrementOffsetAfterRead(4);return b};this.readByte=function(){var b=m.getUint8(d);this.incrementOffsetAfterRead(1);return b};this.readByteArr=function(){var b={canRead:!1,data:null},c=this.readInt();
b.canRead=!0;b.data=new ArrayBuffer(c);(new Uint8Array(b.data)).set((new Uint8Array(f[k])).subarray(d,d+c),0);this.incrementOffsetAfterRead(c);b.dataLen=c;return b};this.readBoolean=function(){return 0!=this.readByte()};this.readMatrix=function(){var b={isNull:!0,arr:[1,0,0,0,1,0,0,0,1],canRead:!0};b.isNull=this.readBoolean();if(b.isNull)return b;var c=this.readByte();if(0==c)return b;for(var d=0;7>d;d++)1==(c>>d&1)?6!=d?b.arr[d]=this.readFloat():b.arr[8]=this.readFloat():0==d||4==d?b.arr[d]=1:6==
d&&(b.arr[8]=1);return b};this.readRect=function(){var b={isNull:!0,left:0,top:0,right:0,bottom:0,canRead:!0};b.isNull=this.readBoolean();if(b.isNull)return b;b.left=this.readInt();b.top=this.readInt();b.right=this.readInt();b.bottom=this.readInt();return b};this.readRectF=function(){var b={isNull:!0,left:0,top:0,right:0,bottom:0,canRead:!0};b.isNull=this.readBoolean();if(b.isNull)return b;b.left=this.readFloat();b.top=this.readFloat();b.right=this.readFloat();b.bottom=this.readFloat();return b};
this.readBoundsAndMatrix=function(){var b={canRead:!1,bounds:null,matrix:null};b.bounds=this.readRect();if(!b.bounds.canRead)return b;b.matrix=this.readMatrix();if(!b.matrix.canRead)return b;b.canRead=!0;return b};this.readIntArr=function(){for(var b={canRead:!1,arr:[]},c=this.readInt(),d=0;d<c;d++)b.arr[d]=this.readInt();b.canRead=!0;return b};this.readUInt32Arr=function(){for(var b={canRead:!1,arr:[]},c=this.readInt(),d=0;d<c;d++)b.arr[d]=this.readUInt32();b.canRead=!0;return b};this.readCharArr=
function(){for(var b={canRead:!1,arr:[]},c=this.readInt(),d=0;d<c;d++)b.arr.push(this.readChar());b.canRead=!0;return b};this.readFloatArr=function(){for(var b={canRead:!1,arr:[]},c=this.readInt(),d=0;d<c;d++)b.arr[d]=this.readFloat();b.canRead=!0;return b};this.readShader=function(b,c,d){b={canRead:!1};var e=d.lo>>24&3;if(e==ShaderType.LinearGradient){var f=this.readFloat(),k=this.readFloat(),m=this.readFloat(),n=this.readFloat();c=this.readUInt32Arr();if(!c.canRead)return b.canRead=!1,b;c=c.arr;
var u=null;if(!this.readBoolean()){e=this.readFloatArr();if(!e.canRead)return b.canRead=!1,b;u=e.arr}d=d.lo>>20&3;e=this.readMatrix();return e.canRead?b={canRead:!0,stype:ShaderType.LinearGradient,x0:f,y0:k,x1:m,y1:n,colors:c,positions:u,tile:d,localMatrix:e}:(b.canRead=!1,b)}if(e==ShaderType.BitmapShader){if(this.readBoolean())return Log.e(TAG,"could not read bitmap of paint shader"),{canRead:!0,stype:null};e=this.readBitmapCache(c);if(!e.canRead)return b.canRead=!1,b;c=e.bitmap;u=e.retVal;e=this.readMatrix();
if(!e.canRead)return b.canRead=!1,b;b=d.lo>>20&3;d=d.lo>>22&3;return u==NuboStatus.FAIL?(Log.e(TAG,"readShader: bitmap could not be retrieved"),{canRead:!0,stype:null}):{canRead:!0,stype:ShaderType.BitmapShader,bitmap:c,tileX:b,tileY:d,localMatrix:e}}if(e==ShaderType.RadialGradient){f=this.readFloat();k=this.readFloat();m=this.readFloat();c=this.readUInt32Arr();if(!c.canRead)return b.canRead=!1,b;c=c.arr;u=null;if(!this.readBoolean()){e=this.readFloatArr();if(!e.canRead)return b.canRead=!1,b;u=e.arr}d=
d.lo>>20&3;return{canRead:!0,stype:ShaderType.RadialGradient,x:f,y:k,radius:m,colors:c,positions:u,tile:d}}Log.e(TAG,"Illegal shader type");return{canRead:!0,stype:null}};this.handleCompressedData=function(b,c){b.flags=c.lo&511;b.antiAlias=0!=(c.lo&UXIPExport.Paint.ANTI_ALIAS_FLAG);b.filterBitmap=0!=(c.lo&UXIPExport.Paint.FILTER_BITMAP_FLAG);b.dither=0!=(c.lo&UXIPExport.Paint.DITHER_FLAG);b.underlineText=0!=(c.lo&UXIPExport.Paint.UNDERLINE_TEXT_FLAG);b.strikeThruText=0!=(c.lo&UXIPExport.Paint.STRIKE_THRU_TEXT_FLAG);
b.fakeBoldText=0!=(c.lo&UXIPExport.Paint.FAKE_BOLD_TEXT_FLAG);b.linearText=0!=(c.lo&UXIPExport.Paint.LINEAR_TEXT_FLAG);b.subpixelText=0!=(c.lo&UXIPExport.Paint.SUBPIXEL_TEXT_FLAG);switch(c.lo>>12&3){case 0:b.style=UXIPExport.Style.FILL;break;case 1:b.style=UXIPExport.Style.STROKE;break;case 2:b.style=UXIPExport.Style.FILL_AND_STROKE}switch(c.lo>>14&3){case 0:b.strokeCap=UXIPExport.Cap.BUTT;break;case 1:b.strokeCap=UXIPExport.Cap.ROUND;break;case 2:b.strokeCap=UXIPExport.Cap.SQUARE}switch(c.lo>>16&
3){case 0:b.strokeJoin=UXIPExport.Join.MITER;break;case 1:b.strokeJoin=UXIPExport.Join.ROUND;break;case 2:b.strokeJoin=UXIPExport.Join.BEVEL}switch(c.lo>>18&3){case 0:b.textAlign=UXIPExport.Align.LEFT;break;case 1:b.textAlign=UXIPExport.Align.CENTER;break;case 2:b.textAlign=UXIPExport.Align.RIGHT}b.hinting=c.lo>>26&1;b.pdMode=c.lo>>27&31;b.textSize=(c.hi&4095)-.6;b.strokeWidth=c.hi>>12&255};this.readPaint=function(b){var c={canRead:!1,p:null};if(!this.readBoolean()){c.p={};var d=this.readLong();this.handleCompressedData(c.p,
d);if(1==(d.hi>>24&1)){var e=this.readUInt32();c.p.color=e&16777215;c.p.alpha=e>>>24}else c.p.color=0,c.p.alpha=255;c.p.textScaleX=1==(d.hi>>20&1)?this.readFloat():1;c.p.textSkewX=1==(d.hi>>21&1)?this.readFloat():0;if(63!=(d.lo>>20&63)){b=this.readShader(c.p,b,d);if(!b.canRead)return c;c.p.shader=b}b=d.lo>>9&7;if(b>=UXIPExport.Typeface.NORMAL&&b<=UXIPExport.Typeface.BOLD_ITALIC){e="";if(1==(d.hi>>22&1)){var f=this.readString();if(!f.canRead)return c;e=f.value}f="";if(1==(d.hi>>23&1)){f=this.readString();
if(!f.canRead)return c;f=f.value}null!=e&&""==!e&&(c.p.fontPath=e);null!=f&&""!=f.equals&&(c.p.fontFamilyName=f);c.p.typefaceStyle=b}}c.canRead=!0;return c};this.readNinePatchChunkCache=function(b){var c={canRead:!1,isNull:!0,data:null};c.isNull=this.readBoolean();if(c.isNull)c.canRead=!0;else{var d=this.readBoolean(),f=this.readLong(),f=f.hi.toString(16)+"_"+f.lo.toString(16);c.isNull=!1;c.hash=f;if(d)b=e.getCacheItem(b,c.hash),null!=b&&(c.canRead=!0,c.data=b);else{d=this.readByteArr();if(!d.canRead)return c;
f=this.readInt();c.data=d.data;c.canRead=!0;0!=f&&e.removeCacheItems(f);e.addCacheItem(b,c.hash,c.data)}}return c};this.readBitmapCache=function(b){var c={canRead:!1,retVal:NuboStatus.FAIL,bitmap:null};if(this.readBoolean())c.canRead=!0;else{var d=this.readByte();switch(d){case BitmapSendRcvType.fullBitmap:c=this.readFullBitmap(b);break;case BitmapSendRcvType.cachedBitmap:c=this.readCachedBitmap(b);break;case BitmapSendRcvType.resourceBitmap:c=this.readResourceBitmap();break;case BitmapSendRcvType.assetBitmap:c=
this.readAssetBitmap();break;default:Log.v(TAG,"VWEInputStream::readBitmapCache. undefined BitmapSendRcvType="+d),c.canRead=!0}}return c};this.readCachedBitmap=function(b){var c={canRead:!1,retVal:NuboStatus.FAIL,bitmap:null},d=this.readLong();c.canRead=!0;c.hash=d.hi.toString(16)+"_"+d.lo.toString(16);b=e.getCacheItem(b,c.hash);null!=b&&(c.retVal=NuboStatus.OK,c.bitmap=b);return c};this.readFullBitmap=function(b){var c={canRead:!1,retVal:NuboStatus.FAIL,bitmap:null},m=this.readLong();c.byteCnt=this.readInt();
c.bitmap={bitmapType:"platform",data:null};c.bitmap.data=new ArrayBuffer(c.byteCnt);(new Uint8Array(c.bitmap.data)).set((new Uint8Array(f[k])).subarray(d,d+c.byteCnt),0);this.incrementOffsetAfterRead(c.byteCnt);var n=this.readInt();c.canRead=!0;c.retVal=NuboStatus.OK;c.hash=m.hi.toString(16)+"_"+m.lo.toString(16);"ffffffff_ffffffff"!=c.hash&&(0!=n&&e.removeCacheItems(n),e.addCacheItem(b,c.hash,c.bitmap));return c};this.readResourceBitmap=function(){var b={canRead:!1,retVal:NuboStatus.FAIL,bitmap:null};
this.readInt();var c=this.readString();if(!c.canRead)return b;c=c.value;b.canRead=!0;if(null==c||""==c)return Log.e(TAG,"readBitmapFromExtRes. Illegal input. resPath="+c),b;b.bitmap={bitmapType:"res",data:null,path:"extres/"+c+"?deviceName=web&resolution=1024x768"};b.retVal=NuboStatus.OK;return b};this.readAssetBitmap=function(){var b={canRead:!1,retVal:NuboStatus.FAIL,bitmap:null};if(!this.readString().canRead)return b;b.canRead=!0;b.retVal=NuboStatus.OK;return b};this.rollback=function(b){u&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,
"zlibReader:: rollback "+b+" bytes.");d-=b;for(n-=b;0>d&&0<k;)u&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"zlibReader:: Moved to previous buffer!"),k--,d+=f[k].byteLength,m=new DataView(f[k],0)};this.readString=function(){var b={value:null,canRead:!0};if(0!=this.readByte())return b;var c=this.readInt16();if(0==c)return b.value="",b;var e=new Uint8Array(f[k],d,c);b.value=UTF8.decode(e);this.incrementOffsetAfterRead(c);return b};this.readCachedString=function(b){var c={canRead:!1,value:null};if(0!=this.readBoolean())return c.canRead=
!0,c;var m=this.readByte(),n=this.readLong();c.hash=n.hi.toString(16)+"_"+n.lo.toString(16);if(m==y.fullString){m=this.readInt16();if(0==m)return c.value="",c.canRead=!0,c;n=new Uint8Array(f[k],d,m);c.value=UTF8.decode(n);this.incrementOffsetAfterRead(m);"ffffffff_ffffffff"!=c.hash&&(m=this.readInt(),0!=m&&e.removeCacheItems(m),e.addCacheItem(b,c.hash,c.value))}else m==y.cachedString&&(c.value=e.getCacheItem(b,c.hash),null==c.value&&Log.e(TAG,"readCachedString. could not find string hash in cache. hashCode="+
n));c.canRead=!0;return c};var y={fullString:1,cachedString:2};this.readCachedPath=function(b){var c={canRead:!1,path:null};if(0!=this.readBoolean())return c.canRead=!0,c;var d=this.readByte(),f=this.readLong();c.hash=f.hi.toString(16)+"_"+f.lo.toString(16);if(d==PathSendRcvType.fullPath){d=this.readFullPath();if(!d.canRead)return c;c.path=d.path;this.readInt();d=this.readInt();"ffffffff_ffffffff"!=c.hash&&(0!=d&&e.removeCacheItems(d),e.addCacheItem(b,c.hash,c.path))}else d==PathSendRcvType.cachedPath&&
(c.path=e.getCacheItem(b,c.hash),null==c.path&&Log.e(TAG,"readCachedPath. could not find string hash in cache. hashCode="+f));c.canRead=!0;return c};this.readFullPath=function(){var b={canRead:!1,path:null},c=this.readByteArr();if(!c.canRead)return b;b.canRead=!0;for(var d=new DataView(c.data,0),e=0,f=d.getInt32(e,!0),e=e+4,m=d.getInt32(e,!0),e=e+4,k=d.getInt32(e,!0),e=e+4,n=[],u=0;u<2*f;u++)n[u]=d.getFloat32(e,!0),e+=4;f=[];for(u=0;u<m;u++)f[u]=d.getInt8(e,!0),e++;b.path={};b.path.verbs=f;b.path.points=
n;if(3<c.dataLen-e)return Log.e(TAG,"Error: mismatch sizes len = "+buf.length+"; padding = "+(buf.length-padding)),b;c=k>>8;b.path.segmentMask=k&255;switch(c){case 0:b.path.FillType=Path.FillType.WINDING;break;case 1:b.path.FillType=Path.FillType.EVEN_ODD;break;case 2:b.path.FillType=Path.FillType.INVERSE_WINDING;Log.e(TAG,"readFullPath:: unimplemented fillType "+c);break;case 3:b.path.FillType=Path.FillType.INVERSE_EVEN_ODD;Log.e(TAG,"readFullPath:: unimplemented fillType "+c);break;default:Log.e(TAG,
"readFullPath:: Wrong fillType "+c),b.path=null}return b};this.readCachedFloatArray=function(b){var c={canRead:!1,floatArr:null},d=this.readByte(),f=this.readInt(),m=null;if(d==UXIPExport.FloatArrSendRcvType.fullArray){m=this.readFloatArr();if(!m.canRead)return c;d=this.readInt();m=m.arr;-1!=f&&(0!=d&&e.removeCacheItems(b,d),e.addCacheItem(b,f.toString(),m))}else d==UXIPExport.FloatArrSendRcvType.cachedArray&&(m=e.getCacheItem(b,f.toString()),null==m&&Log.e(TAG,"readCachedFloatArr. could not find string hash in cache. hashCode="+
f));c.canRead=!0;c.floatArr=m;return c}}
function testReader(){for(var e=new UXIPReader,f=new ArrayBuffer(50),k=new Uint8Array(f),d=0;d<k.length;d++)k[d]=d;for(var k=new ArrayBuffer(50),m=new Uint8Array(k),d=0;d<m.length;d++)m[d]=49-d;e.addBuffer(f);console.log("canReadBytes(10)="+e.canReadBytes(10));console.log("canReadBytes(50)="+e.canReadBytes(50));e.compact();f=e.readInt();console.log(f);e.compact();f=e.readInt();console.log(f);e.compact();f=e.readInt();console.log(f);e.compact();console.log("canReadBytes(60)="+e.canReadBytes(60));e.addBuffer(k);
console.log("buffArr.length="+e.getBuffArr().length);console.log("canReadBytes(10)="+e.canReadBytes(10));console.log("offset="+e.getOffset());for(d=0;10>d;d++)f=e.readByte(),console.log(f);console.log("offset="+e.getOffset());k=new UXIPReader;console.log("reader2.offset="+k.getOffset());console.log("canReadBytes(10)="+e.canReadBytes(10));for(d=0;10>d;d++)f=e.readByte(),console.log(f);console.log("offset="+e.getOffset());console.log("reader2.offset="+k.getOffset());console.log("reader.getBuffArr()[reader.getBuffIdx()].byteLength="+
e.getBuffArr()[e.getBuffIdx()].byteLength);e.compact();console.log("reader.getBuffArr()[reader.getBuffIdx()].byteLength="+e.getBuffArr()[e.getBuffIdx()].byteLength);for(d=0;17>d;d++)e.canReadBytes(1),f=e.readByte(),console.log(f);e.canReadBytes(4);f=e.readInt();console.log(f);console.log("reader.getBuffArr()[reader.getBuffIdx()].byteLength="+e.getBuffArr()[e.getBuffIdx()].byteLength);console.log("offset="+e.getOffset());for(d=0;47>d;d++)e.canReadBytes(1),f=e.readByte(),console.log(f);e.compact();
console.log("offset="+e.getOffset());d=UTF8.encode("TEST\u05d7\u05d5\u05e8\u05e3? 30 \u05de\u05e2\u05dc\u05d5\u05ea \u05d1\u05d9\u05dd \u05d4\u05de\u05dc\u05d7 TEST");k=d.byteLength;f=new ArrayBuffer(3);m=new DataView(f,0);m.setInt8(0,0);m.setInt16(1,k);k=e.readString();k.canRead?console.log("Str="+k.value):console.log("Cannot read string yet");e.addBuffer(f);k=e.readString();k.canRead?console.log("Str="+k.value):console.log("Cannot read string yet");e.addBuffer(d);k=e.readString();k.canRead?console.log("Str="+
k.value):console.log("Cannot read string yet")}TAG="UXIP";function Log(){}Log.v=function(e,f){console.log("["+e+"] "+f)};Log.e=function(e,f){console.error("["+e+"] "+f)};Log.d=function(e,f){console.info("["+e+"] "+f)};"undefined"!=typeof module&&(module.exports={UXIPReader:UXIPReader,testReader:testReader},UTF8=require("./utf8.js").UTF8,NuboCache=require("./nubocache.js").NuboCache,UXIPExport=require("./uxip.js"));var BUFFSIZE=1024,COMPRESSION_HEADER_SIZE=5;
function UXIPWriter(e){var f=new ArrayBuffer(BUFFSIZE),k=new DataView(f,0),d=0;if(null==m)var m=!1;this.flush=function(){var n=f.slice(0,d);m&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"uxipwriter:: Flush "+d+" bytes");if(NuboOutputStreamMgr.getInstance().getWithService()||!NuboOutputStreamMgr.getInstance().getIsPlayerLogin()){var n=new ArrayBuffer(d+COMPRESSION_HEADER_SIZE),u=new DataView(n,0);u.setInt8(0,0);u.setInt32(1,d);for(var y=0;y<d;y++)u.setInt8(y+COMPRESSION_HEADER_SIZE,k.getInt8(y))}e(n);d=0;1024<
BUFFSIZE&&(BUFFSIZE=1024,f=new ArrayBuffer(BUFFSIZE),k=new DataView(f,0))};this.checkBufferSpace=function(e){if(d+e>BUFFSIZE){BUFFSIZE*=2;e=new ArrayBuffer(BUFFSIZE);for(var m=new DataView(e,0),y=0;y<d;y++)m.setInt8(y,k.getInt8(y));f=e;k=m;console.log("Resize buffer to "+BUFFSIZE+" bytes.")}};this.writeInt=function(e){this.checkBufferSpace(4);k.setInt32(d,e);d+=4};this.writeInt16=function(e){this.checkBufferSpace(2);k.setInt16(d,e);d+=2};this.writeFloat=function(e){this.checkBufferSpace(4);k.setFloat32(d,
e);d+=4};this.writeByte=function(e){this.checkBufferSpace(1);k.setInt8(d,e);d+=1};this.writeBoolean=function(d){this.writeByte(d?1:0)};this.writeLong=function(e){this.checkBufferSpace(8);k.setUint32(d,e.hi);d+=4;k.setUint32(d,e.lo);d+=4};this.writeLongAsFloat=function(e){this.checkBufferSpace(8);k.setFloat64(d,e);d+=8};this.writeString=function(e){if(null==e)this.writeByte(1);else{var f=UTF8.encode(e);e=f.byteLength;this.writeByte(0);this.writeInt16(e);f=e?new DataView(f,0):null;this.checkBufferSpace(e);
for(var m=0;m<e;m++){var b=f.getUint8(m);k.setUint8(d,b);d++}}};this.writeKeyEvent=function(d){if(null!=d){this.writeBoolean(!1);var e={hi:0,lo:0};this.writeLong(e);this.writeLong(e);this.writeInt(d.action);this.writeInt(d.keyCode);this.writeInt(0);this.writeInt(0);this.writeInt(-1);this.writeInt(0);this.writeInt(0);this.writeInt(0);d=d.characters;"undefined"==d&&(d=null);this.writeString(d)}else this.writeBoolean(!0)};this.notifyClearProcessCache=function(d){d="string"===typeof d?parseInt(d):d;var e=
getNuboByte(PlayerCmd.clearProcessCache);NuboOutputStreamMgr.getInstance().sendCmd(e,d)};this.startNuboCmd=function(){d=0;!NuboOutputStreamMgr.getInstance().getWithService()&&NuboOutputStreamMgr.getInstance().getIsPlayerLogin()||this.writeInt(0)};this.endNuboCmd=function(){!NuboOutputStreamMgr.getInstance().getWithService()&&NuboOutputStreamMgr.getInstance().getIsPlayerLogin()||k.setInt32(0,d)}}function getNuboByte(e){return{name:"nuboByte",val:e}}
function testWriter(){var e=new UXIPWriter(function(e){console.log("send byteLength="+e.byteLength)});e.writeInt(5);e.writeInt(50);e.writeFloat(50.5);for(var f=0;2E3>f;f++)e.writeByte(f);e.writeString("TESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTESTTEST");
e.flush();for(f=0;2E3>f;f++)e.writeByte(f);e.flush()}"undefined"!=typeof module&&(module.exports={UXIPWriter:UXIPWriter,testWriter:testWriter},UTF8=require("./utf8.js").UTF8);function WindowManager(e,f,k,d,m,n){var u,y,b,c,p,x=0,A,N,I,G,C={},J=new TaskManager(d);A=function(b,c){for(var d=b.length-1;0<=d;d--)if(b[d].wndId==c||b[d].nuboWndId==c||0==c)return d;return-1};N=function(b,c){for(var d=b.length-1;0<=d;d--)if(b[d].nuboWndId==c)return d;return-1};this.clearPopupCanvas=function(b,c,d,e){b=this.getWindow(b,c);if(null==b.ctx)Log.e("wm","clearPopupCanvas: no popup window");else if(null==b.popup_x)b.popup_x=d,b.popup_y=e;else if(b.popup_x!=d||b.popup_y!=e)b.popup_x=d,
b.popup_y=e,b.ctx.clearRect(0,0,b.canvas.width,b.canvas.height)};this.getWindow=function(b,c){var d=b.toString(16),d=C[d];if(null==d)return Log.e("wm","Process not found in window manager: "+b),null;var e=A(d,c);return 0>e?(Log.e("wm","Wnd not found in window manager: "+c),null):d[e]};this.hideWindow=function(b,c){var d=this.getWindow(b,c);null!=d&&(d.visible=!1,G(d))};this.showWindow=function(b,c){var d=this.getWindow(b,c);null!=d&&(d.visible=!0,G(d))};this.updateWndId=function(b,c,d){var e=b.toString(16),
e=C[e];null==e?Log.e("wm","Process not found in window manager: "+b):(b=N(e,d),0>b?Log.e("wm","Wnd not found in window manager: "+d):e[b].wndId=c)};this.removeWindowFromStack=function(b,c){var d=b.toString(16),d=C[d];if(null==d)Log.e("wm","Process not found in window manager: "+b);else{var e=N(d,c);if(0>e)Log.e("wm","Wnd not found in window manager: "+c);else{var f=d[e];f.visible=!1;G(f);d.splice(e,1);J.removeWndFromTask(f);u.removeChild(f.canvas);return 0==d.length}}};this.writeTransaction=function(b,
c){var d=this.getWindow(b,c);if(null!=d)if(null==d.dirtyCanvas)Log.e("writeTransaction: Missing dirtyCanvas");else{var e=d.dirtyCtx.getImageData(d.dirtyRect.left,d.dirtyRect.top,d.dirtyRect.right-d.dirtyRect.left,d.dirtyRect.bottom-d.dirtyRect.top);d.ctx.putImageData(e,d.dirtyRect.left,d.dirtyRect.top);G(d)}else Log.e("writeTransaction: Window not found: "+b+","+c)};this.setDirtyRect=function(c,d,e){var f=this.getWindow(c,d);null!=f?(f.dirtyCanvas=document.createElement("canvas"),f.dirtyCanvas.setAttribute("width",
y),f.dirtyCanvas.setAttribute("height",b),f.dirtyCtx=f.dirtyCanvas.getContext("2d"),f.saveLayers=[],c=f.ctx.getImageData(0,0,y,b),f.dirtyCtx.putImageData(c,0,0),f.dirtyRect=e):Log.e("setDirtyRect: Window not found: "+c+","+d)};this.saveLayerAlpha=function(c,d,e){var f=this.getWindow(c,d);null!=f?(c=document.createElement("canvas"),c.setAttribute("width",y),c.setAttribute("height",b),d=c.getContext("2d"),f.saveLayers.push(f.dirtyCanvas),f.dirtyCanvas=c,f.dirtyCtx=d,f.dirtyCanvas.savedAlpha=e/255):
Log.e("saveLayerAlpha: Window not found: "+c+","+d)};this.restoreLayer=function(b,c){var d=this.getWindow(b,c);if(null!=d)if(1>d.saveLayers.length)Log.e("restoreLayer: saved layers not found.");else{var e=d.saveLayers.pop(),f=e.getContext("2d"),m=f.globalAlpha;f.globalAlpha=d.dirtyCanvas.savedAlpha;f.drawImage(d.dirtyCanvas,0,0);f.globalAlpha=m;d.dirtyCanvas=e;d.dirtyCtx=f}else Log.e("restoreLayer: Window not found: "+b+","+c)};this.hideProcess=function(b){if(null!=b&&(b=b.toString(16),b=C[b],null!=
b))for(var c=0;c<b.length;c++)$("#"+b[c].canvas.id).hide()};this.updateWinLocation=function(b,c,d,e,f,m){b=this.getWindow(b,c);null!=b&&(b.x=d,b.y=e,b.width=f,b.height=m,b.canvas.setAttribute("width",b.width),b.canvas.setAttribute("height",b.height),G(b))};G=function(b){var c={position:"absolute",visibility:b.visible?"visible":"hidden",left:b.x+"px",top:b.y+"px",width:b.width+"px",height:b.height+"px","z-index":b.zindex};$("#"+b.canvas.id).css(c)};this.moveTaskToTop=function(b){J.setLastTopTaskId(b);
b=J.moveTaskToTop(b);if(null!=b)for(var c=0;c<b.length;c++)x++,b[c].zindex=x,G(b[c])};this.updateWndTaskPos=function(b,c,d){b=this.getWindow(b,c);b.taskId=J.getTaskId(d);b.posInTask=J.getPosInTask(d)};this.pushWndOnStack=function(d,e,f,m,k,n,A,H,N,I,K,B){n=d.toString(16);A=e.toString(16);var a=C[n];null==a&&(a=[],C[n]=a);var q={};q.canvas=document.createElement("canvas");q.x=0;q.y=0;q.width=y;q.height=b;q.visible=!1;q.canvas.setAttribute("width",q.width);q.canvas.setAttribute("height",q.height);q.canvas.id=
"c_"+n+"_"+A;q.ctx=q.canvas.getContext("2d");q.wndId=e;q.nuboWndId=f;q.processId=d;q.gravity=k;q.containerType=m;q.onTopOfKeyboard=H;q.orientation=N;q.inputMethodMode=I;var F=null;q.mouseEvent=function(a){a=a||event;a.name="MouseEvent";a.src=this;"mouseup"==a.type?F=null:"mousedown"==a.type&&(F=(new Date).getTime());a.lastMouseDownTouchTime=F;NuboOutputStreamMgr.getInstance().sendCmd(c.nuboByte(PlayerCmd.touchEvent),q.processId,q.wndId,a)};q.mousemove=function(a){a=a||event;a.name="MouseEvent";a.src=
this;a.preventDefault();F&&(a.lastMouseDownTouchTime=F,NuboOutputStreamMgr.getInstance().sendCmd(c.nuboByte(PlayerCmd.touchEvent),q.processId,q.wndId,a))};q.keyEvent=function(a){console.log("key event");c.keyEvent(a||event,q.processId,q.wndId,this)};q.touchEvent=function(a){a=a||event;a.name="TouchEvent";a.src=this;a.preventDefault();"mousemove"!=a.type&&(F="touchend"==a.type||"touchcancel"==a.type?null:"touchstart"==a.type?(new Date).getTime():null);a.lastMouseDownTouchTime=F;NuboOutputStreamMgr.getInstance().sendCmd(c.nuboByte(PlayerCmd.touchEvent),
q.processId,q.wndId,a)};q.canvas.onmouseup=q.mouseEvent;q.canvas.onmousedown=q.mouseEvent;q.canvas.onmousemove=q.mousemove;q.canvas.onkeypress=q.keyEvent;q.canvas.onkeydown=q.keyEvent;q.canvas.onkeyup=q.keyEvent;q.canvas.addEventListener("touchstart",q.touchEvent,!1);q.canvas.addEventListener("touchend",q.touchEvent,!1);q.canvas.addEventListener("touchcancel",q.touchEvent,!1);q.canvas.addEventListener("touchleave",q.touchEvent,!1);q.canvas.addEventListener("touchmove",q.touchEvent,!1);q.dirtyCanvas=
null;q.matrix={isNull:!0};q.bounds={isNull:!0};x++;q.zindex=x;q.canvas.setAttribute("tabindex",x);q.taskId=J.getTaskId(K);q.posInTask=J.getPosInTask(K);q.parentWndId=B;J.updateTask(q);a.push(q);d=J.getTaskList();var L;for(e=0;e<Object.keys(d).length;e++)for(f=Object.keys(d)[e],f=d[f],m=0;m<f.length;m++)f[m]==q?L=!0:L&&(x++,f[m].zindex=x,G(f[m]));0==u.childNodes.length?u.appendChild(q.canvas):u.insertBefore(q.canvas,u.childNodes[0]);G(q);window.location.hash="ppage/"+x;p=window.location.hash;q.canvas.focus();
return q};I=function(b){for(;;){var c=b.pop();if(null==c)break;J.removeWndFromTask(c);Log.v("wm","Remove canvas "+c.canvas.id);u.removeChild(c.canvas)}};this.prepareCanvasForPaint=function(b,c,d){b=this.getWindow(b,c);if(null==b)return null;c=b.dirtyCtx;if(null==c)return null;c.save();d.matrix.isNull||(b.matrix=d.matrix);d.bounds.isNull||(b.bounds=d.bounds);b.matrix.isNull&&b.bounds.isNull||(b.matrix.isNull||c.setTransform(b.matrix.arr[0],b.matrix.arr[3],b.matrix.arr[1],b.matrix.arr[4],b.matrix.arr[2],
b.matrix.arr[5]),b.bounds.isNull||(c.rect(b.bounds.left,b.bounds.top,b.bounds.right-b.bounds.left,b.bounds.bottom-b.bounds.top),c.clip()));c.beginPath();return c};this.removeProcess=function(b){var c=b.toString(16),d=C[c];null==d?Log.e("wm","Process not found in window manager: "+b):(I(d),delete C[c])};this.killAll=function(){for(var b in C)I(C[b])};this.getLastProcessIdOnStack=function(){return parseInt(Object.keys(C)[Object.keys(C).length-1],16)};this.getLastNotKeyboardProcessIdOnStack=function(b){for(var c=
Object.keys(C).length-1;0<=c;c--){var d=parseInt(Object.keys(C)[c],16);if(d!=b)return d}return 0};u=e;y=f;b=k;c=d;var K=document.createElement("img");K.setAttribute("src",n+"/html/player/images/dragdrop.png");K.setAttribute("width",y);K.setAttribute("height",b);K.id="dropcanvas";u.appendChild(K);e={position:"absolute",visibility:"hidden",left:"0px",top:"0px",width:y+"px",height:b+"px","z-index":"10000"};$("#dropcanvas").css(e);$("#dropcanvas").dropzone({url:n+"/file/uploadToSession?session="+m,accept:function(b,
c){console.log("file: ",b);c()}});u.addEventListener("dragenter",function(b){b.stopPropagation();b.preventDefault();$("#dropcanvas").css("visibility","visible");console.dir(b)},!1);u.addEventListener("dragleave",function(b){b.stopPropagation();b.preventDefault();console.dir(b);if(b.target==u||b.target==K)$("#dropcanvas").css("visibility","hidden"),console.log("hide drop")},!1);u.addEventListener("dragover",function(b){b.stopPropagation();b.preventDefault()},!1);window.addEventListener("dragover",
function(b){b=b||event;b.preventDefault()},!1);window.addEventListener("drop",function(b){b=b||event;b.preventDefault()},!1);m=Dropzone.forElement("#dropcanvas");var F=0;m.on("success",function(b,c){0==c.status&&(console.log("ERROR. file.name: "+b.name+", status "+c.status+", message: "+c.message),console.log("ERROR. file.fileid: "+b.fileid),$("#"+b.fileid).css("display","none"),$("#icon_"+b.fileid).css("display","none"),$("#name_"+b.fileid).css("display","none"),$("#uploadErrorMsg").css("visibility",
"visible"))});m.on("complete",function(b){$("#dropcanvas").css("visibility","hidden");console.log("Uploaded");$("#progress_"+b.fileid).hide();$("#icon_"+b.fileid).css("opacity","1")});m.on("drop",function(b){$("#dropcanvas").css("visibility","hidden");console.log("dropped")});m.on("addedfile",function(b){console.log("addedfile");b.fileid||(F++,b.fileid="file_"+F);$("#uploadContent").prepend('<div class="fileItem" id="'+b.fileid+'"><div class="fileIcon" id="icon_'+b.fileid+'"></div><div class="fileName" id="name_'+
b.fileid+'">'+b.name+'</div><progress id="progress_'+b.fileid+'" max="100" value="0"></progress></div>');5==F&&$("#uploadContent").css("overflow-y","scroll");$("#uploadFiles").css("visibility","visible");$("#uploadErrorMsg").css("visibility","hidden")});m.on("uploadprogress",function(b,c,d){console.log("uploadprogress");$("#"+b.fileid).length&&$("#progress_"+b.fileid).attr("value",c)});$("#uploadX").click(function(){$("#uploadFiles").css("visibility","hidden")});$("#btnErrorMsg").click(function(){$("#uploadErrorMsg").css("visibility",
"hidden");console.log("btnErrorMsg.click filecnt: "+F);0==F&&$("#uploadFiles").css("visibility","hidden")});var S=!1,U=0,O=0,V=0,T=0,L=document.getElementById("uploadFiles");$("#uploadTitle").mousedown(function(b){U=b.clientX;O=b.clientY;V=parseInt(L.style.left);T=parseInt(L.style.top);S=!0});$("#uploadTitle").mouseup(function(){S=!1});$("#uploadTitle").mousemove(function(b){if(S)return L.style.left=V+b.clientX-U,L.style.top=T+b.clientY-O,!1});window.onhashchange=function(){window.location.hash!=
p&&(window.history.forward(),c.clickBack())}}function Log(){}Log.v=function(e,f){console.log("["+e+"] "+f)};Log.e=function(e,f){console.error("["+e+"] "+f)};
function TaskManager(e){var f={},k;this.moveTaskToTop=function(e){e=d(e);if(Object.keys(f)[Object.keys(f).length-1]==e)return null;var k=f[e];delete f[e];return f[e]=k};this.updateTask=function(e){var n=ContainerType.POPUPWINDOW,u=ContainerType.ACTIVITY,y=ContainerType.DIALOG;if(e.containerType==n)this.addPopupWindow(e);else{var b=d(e.taskId),c=f[b];null==c&&(c=[]);if(0==c.length)0==Object.keys(f).length||k==e.taskId?f[b]=c:(n=Object.keys(f)[Object.keys(f).length-1],u=f[n],delete f[n],f[b]=c,f[n]=
u),c.push(e);else if(0<c.length){for(var p=0;p<c.length;p++)if(b=c[p],b.containerType!=n){if(e.posInTask<b.posInTask||b.posInTask==e.posInTask&&b.containerType==y&&e.containerType==u){c.splice(p,0,e);return}if(b.posInTask==e.posInTask&&b.containerType==n&&e.containerType!=n){c.splice(p,0,e);e.posInTask++;return}}c.push(e)}else Log.e(TAG,"updateTask::task.length = "+c.length)}};this.addPopupWindow=function(d){for(var e,k,y=0;y<Object.keys(f).length;y++){e=Object.keys(f)[y];k=f[e];for(var b=0;b<k.length;b++){var c=
k[b];if(c.wndId==d.parentWndId||c.nuboWndId==d.parentWndId){k.push(d);e=parseInt(e.substring(0,e.length-1),16);d.taskId=e;d.posInTask=k.length-1;return}}}Log.e(TAG,"TaskManager::addPopupWindow: can not find parent of popup")};this.removeWndFromTask=function(e){var k=d(e.taskId),k=f[k];e=k.indexOf(e);-1<e?k.splice(e,1):Log.e(TAG,"TaskManager::removeWndFromTask: can not find window in task")};this.setLastTopTaskId=function(d){k=d};this.getTaskList=function(){return f};this.getTaskId=function(d){return d>>
9};this.getPosInTask=function(d){return d&511};var d=function(d){return d.toString(16)+"_"},d};var zlibnode;
function ZlibReader(){var e=[],f=0,k=0,d=null,m=this;if(null==n)var n=!1;this.addBuffer=function(k){e.push(k);f+1==e.length&&(d=new DataView(e[f],0))};this.inProcessData=!1;this.handle_message=function(){if(m.inProcessData)return!1;m.inProcessData=!0;if(!m.canReadBytes(5))return m.inProcessData=!1;var d=m.readBoolean(),y=m.readUInt32();if(!m.canReadBytes(y))return m.rollback(5),m.inProcessData=!1;n&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"Compress header. deflate: "+d+", inLength: "+y);var b;if(d)if(d=
new Uint8Array(e[f],k,y),zlibnode)d=new Uint8Array(e[f],k,y),d=new Buffer(d),zlibnode.inflate(d,function(c,d){n&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"plain array length: "+d.length);b=new ArrayBuffer(d.length);for(var e=new Uint8Array(b),f=0;f<d.length;++f)e[f]=d[f];m.ondata(b);m.inProcessData=!1;process.nextTick(m.handle_message)});else{var c=(new Zlib.Inflate(d,{index:0,bufferSize:1024,bufferType:0,resize:!0,verify:!0})).decompress();n&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"plain array length: "+c.length);
b=new ArrayBuffer(c.length);d=new Uint8Array(b);d.set(c,0)}else b=new ArrayBuffer(y),d=new Uint8Array(b),c=new Uint8Array(e[f],k,y),d.set(c,0);m.incrementOffsetAfterRead(y);m.compact();return b?(m.ondata(b),m.inProcessData=!1,zlibnode&&process.nextTick(m.handle_message),!0):!1};this.compact=function(){if(1024<=k){var m=e[f];e[f]=new ArrayBuffer(m.byteLength-k);(new Uint8Array(e[f])).set((new Uint8Array(m)).subarray(k),0);k=0;d=new DataView(e[f],0)}0!=f&&(e.splice(0,f),f=0)};this.canReadBytes=function(m){if(e.length<=
f)return!1;if(e[f].byteLength>=k+m)return!0;if(e.length>f+1){var y=e[f+1],b=e[f];e.splice(f+1,1);e[f]=new ArrayBuffer(b.byteLength+y.byteLength);var c=new Uint8Array(e[f]);c.set(new Uint8Array(b),0);c.set(new Uint8Array(y),b.byteLength);d=new DataView(e[f],0);return this.canReadBytes(m)}n&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"Required bytes: "+m+" but have only: "+(e[f].byteLength-k));return!1};this.incrementOffsetAfterRead=function(m){k+=m;k>=e[f].byteLength&&(f++,k=0,e.length>f&&(d=new DataView(e[f],
0)))};this.rollback=function(m){for(k-=m;0>k&&0<f;)n&&Log.d(DEBUG_PROTOCOL_NETWORK_STR,"zlibReader:: Moved to previous buffer!"),f--,k+=e[f].byteLength,d=new DataView(e[f],0)};this.readUInt32=function(){var e=d.getUint32(k);this.incrementOffsetAfterRead(4);return e};this.readByte=function(){var e=d.getUint8(k);this.incrementOffsetAfterRead(1);return e};this.readBoolean=function(){return 0!=this.readByte()}}"undefined"!=typeof module&&(module.exports={ZlibReader:ZlibReader},zlibnode=require("zlib"));var NuboOutputStreamMgr=function(e,f){function k(){return{sendCmd:function(){if(2!=m.protocolState()&&1!=m.protocolState())console.log("NuboOutStreamMgr, socket is not connected");else{u.startNuboCmd();for(var d=0;d<arguments.length;d++){var b=arguments[d];"number"===typeof b?u.writeInt(b):"string"===typeof b?u.writeString(b):"boolean"===typeof b?u.writeBoolean(b):"object"===typeof b&&("KeyEvent"===b.name?u.writeKeyEvent(b):"MouseEvent"===b.name?m.mouseEvent(b):"TouchEvent"===b.name?m.touchEvent(b):
"nuboFloat"===b.name?u.writeFloat(b.val):"nuboLongAsFloat"===b.name?u.writeLongAsFloat(b.val):"nuboByte"===b.name&&u.writeByte(b.val))}u.endNuboCmd();u.flush()}},createSocket:function(d,b,c,e,f){m=e;u=f},getIsPlayerLogin:function(){return n},setIsPlayerLogin:function(d){n=d},getWithService:function(){return!1}}}var d=null,m=null,n=!1,u;return{getInstance:function(){d||(d=new k);return d}}}();
